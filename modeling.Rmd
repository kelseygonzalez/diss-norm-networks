---
title: "Article 3:	The Formation of Behavioral Norms: The Case of Population Mobility and Vaccination Rates During the Covid-19 Pandemic "
author: "Kelsey Gonzalez"
date: "`r format(Sys.time(), '%d %B, %Y')`"
editor_options:
  chunk_output_type: console
output:
  bookdown::pdf_document2: 
    number_sections: true
  word_document:
    keep_md: yes
    reference_docx: StylesTemplate.docx
header-includes:
   - \usepackage{dcolumn}
   - \usepackage{setspace}
   - \doublespacing
csl: american-sociological-association.csl
bibliography: "My Library.bib"
sansfont: Calibri
monofont: Calibri
indent: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE,
                      warning = FALSE,
                      cache = TRUE,
                      dev.args = list(png = list(type = "cairo")))

# knitr::opts_knit$get("rmarkdown.pandoc.to")

pacman::p_load(tidyverse, here, nlme, lme4, stargazer,
               sjPlot, ggeffects, patchwork, ggridges,
               glue)
my_palette = c('#56b4e9','#999999','#E69F00','#009E73','#CC79A7','#0072B2','#D55E00','#E69F00')

count_to_state <- read_csv("https://raw.githubusercontent.com/kjhealy/fips-codes/master/county_fips_master.csv") %>% 
  mutate(FIPS = str_pad(fips, 5, pad = "0")) %>% 
  select(FIPS, state_abbr)


```

```{r load_google}
# source("data-cleaning.R")
google <- read_csv(here("data", "google_movement_main.csv"), show_col_types = FALSE)  %>% 
  drop_na() %>% 
  select(FIPS, date, SAH, movement_assor, sci_prob_self, movement_signal, 
         case_rate, p_white, p_black, p_college, p_hispanic,
         perc_65_over, unemployed_rate, income_med, 
         trump_votes_2016, evangelical_county, fox_news) %>% 
  mutate(week_num = as.numeric((date - lubridate::ymd("2020-03-02")) / 7))
```

```{r load_vacc}
# source("data-cleaning.R")
vacc <- read_csv(here("data", "vacc_main.csv"), show_col_types = FALSE)  %>% 
  select(FIPS, date, vacc_rate, sci_prob_self, vacc_signal, vacc_assor,
         case_rate, p_white, p_black, p_college, p_hispanic,
         perc_65_over, unemployed_rate, income_med, population,
         trump_votes_2020, evangelical_county, fox_news) %>% 
  drop_na() %>% 
    mutate(week_num = as.numeric((date - lubridate::ymd("2020-03-02")) / 7))


```


# Abstract

This article researches the formation of social norms governing health behaviors
in cases of extreme uncertainty using the cases of both a) population mobility
during early 2020 and b) vaccination rates during early 2021, both as responses
to public health recommendations to mitigate the Covid-19 pandemic. Using
theories of complex contagion, associative diffusion and the integrated
theoretical framework of norms, I test how these health behaviors are outcomes
of contagion and discordance of signals, community integration, and other
factors affecting associations like religious and political conservatism, and
attention to television media sources, and online norms as measured by
information-search behaviors. The data for this article derives from a unique
longitudinal data set that I compiled from Google, the CDC, Facebook and other
sources. To model mobility and vaccination rates, I linear mixed effects models
with random effects as a longitudinal model of contagion.

# Background
After spreading around the world in a matter of months, the coronavirus
(COVID-19) has become a leading cause of death in the United States. Although
the Centers for Disease Control and Prevention
(CDC)[-@centersfordiseasecontrolandprevention20] have proposed several potential
mitigation strategies, the  method of mitigation that has received the most
national attention is the call to stay-at-home for non-essential workers. CDC
officials and frontline health care professionals advise that the best way to
prevent exposure to the virus is to stay at home and avoid close contact with
people. 
<!-- TODO needs udpated -->
__If staying at home is so important for slowing the spread of the
coronavirus, we must begin to consider the social patterning of mobility (i.e.,
how far people are traveling in their daily lives) and time spent in residence
(i.e., how much time is spent isolated from other people). While staying at home
is not an option for some members of society due to employment, most people have
the ability to stay at home. The fundamental question is whether the choice to
stay at home varies by certain populations and whether this behavior is socially
contagious.__


There is little research on shelter-in-place or stay-at-home rates, especially
during pandemics or disasters. Though research on the causes of population
mobility (how much a community leaves their homes) did expand after the onset of
the Covid-19 pandemic [@bargainTrustCompliancePublic2020;
@bourassaStatelevelStayathomeOrders2020; @bourassaSocialDistancingHealth2020;
@grossmanPoliticalPartisanshipInfluences2020;
@haggerPredictingSocialDistancing2020; @hillBloodChristCompels2020;
@hillNastiestQuestionDoes2021; @hillLoveThyAged2021;
@huynhDoesCultureMatter2020], most research focused on unchanging cultural
determinants of the reduction in mobility. Instead, this paper will focus on the
dynamic nature of population mobility across population networks.

There is more research on vaccine uptake
[@schmidBarriersInfluenzaVaccination2017] because of increased hesitancy and
anti-vaccination movements [@baumgaertnerInfluencePoliticalIdeology2018;
@hornseyDonaldTrumpVaccination2020; @johnsonOnlineCompetitionPro2020;
@whiteheadHowCultureWars2020], even using methods such as social network
analysis [@milaniVisualVaccineDebate2020]. However, using both population
mobility and vaccine uptake provide an opportunity to conduct related but unique
analyses of the establishment of social health norms. I will first cover the
research on social networks and contagion before covering proposed mechanisms of
the spread of mobility behavior and their respective hypotheses.

## Mechanisms of meso-level behavioral contagion

### The Social Contagion Model

Individuals engage with each other and their distributive ties to create
community contexts where norms, beliefs, and values circulate
[@moodyIntroductionSocialNetworks2019]. These clusters of interaction are called
social networks, and if “each person continues to interact primarily with others
nearby in space, the forces of conformity will be strongest locally, leading to
the emergence of clusters of people sharing similar behavior”
[@kittsAnalyticFrameworkSocial2018]. This community interaction ultimately leads
to converged communities of belief structures with variations in divergence from
the norm [@okadaStructureCulturalRejection2017;
@lataneExperimentalEvidenceDynamic1996;
@cullumCulturalEvolutionInterpersonal2007].


"Culture" diffuses through communities and social networks. Information and
opinions spread [@klarEffectNetworkStructure2017; @bondpolmob;
@fowler2010cooperative], behaviors are adopted
[@christakis2008collective;@rosenquist2010spread;
@aralExerciseContagionGlobal2017; @centolaSpreadBehaviorOnline2010;
@centolaExperimentalStudyHomophily2011] , and there are patterns of health
contagion [@christakisSpreadObesityLarge2007; @cacioppo2009alone]. However,
“different things spread in different ways and to different extents”
[@christakisSocialContagionTheory2013, p 563] and when modeling diffusion and
contagion, we must be very specific about our scope conditions as they are
relevant to our theory and not to cross theories to infer connections where they
may not exist [@kittsRethinkingSocialNetworks2020].

Most of the diffusion literature does not focus on establishment of new norms
but the adoption of culture and specific deviant behaviors (see
@centolaSpontaneousEmergenceConventions2015 for an exception). DellaPosta and
colleagues (-@dellapostaWhyLiberalsDrink2015) outline how the spread of culture
and behavior is tied to network autocorrelation, or “the tendency for people to
resemble their network neighbors”. They show that the distance between to agents
in sociocultural space can determine the likelihood of the adoption of a new
behavior. Like Axelrod [-@axelrodDisseminationCultureModel1997] this outlines
how the of local convergence of close network actors becomes amplified and can
lead to global polarization between groups.

<!-- TODO needs updated, make sure paragraph on complex contagion is here -->
There are many other theoretical mechanisms that lead to the establishment of
diverse behavioral norms. Some I won’t discuss here include network isolation
(Kitts and Shi 2018:6) and discordance of network signals / complex contagion
(Centola and Macy 2007; Houghton 2021; Rivera, Soderstrom, and Uzzi 2010). These
will receive a full review in the full paper, but are not central to the framing
of establishment of norms for this proposal.

(@) _Hypothesis 1_ Relatively higher local rates of infection will lead to increased time spent in residence and increase vaccination uptake



### Network Isolation

<!-- TODO needs udpated -->

The most basic component of a network that can be measured is degree, or number
of connections an ego has. In this case, a lack of connections between counties
indicates a more isolated community. A lack of geographically diverse
friendships (i.e. low geographic social connectedness) may indicate isolation,
rurality and possibly insular culture. Though rural communities are unlikely to
be isolated from mainstream urban cultural and economic influences
[@lichter2011rural], disconnected rural communities are notably resistant to
policy interventions and are often mistrusting of the federal government
[@lichter2008race; @partridge2006geography]. The guiding question of this paper
looks to investigate the choice to adhere to government mandated stay at home
orders. Because disconnected communities are resistant to policy change and
mistrust the central government, I theorize that there will not be an increase
in time spent in residence.
<!-- TODO needs udpated, focus on community integration and acceptance of new norms instead -->


(@) _Hypothesis 2_ Having a low percent of Facebook friends living outside of the county will not lead to an increase in time spent in residence and decrease in vaccine uptake.

### Complex Contagion and Discordance: 
@centolaComplexContagionsWeakness2007 theorize that simple contagions are not
  enough to spread behavioral change. Simple contagions are those in which only
  one point of contact is needed to receive contagion, like with infectious
  disease or to learn simple bits of information.
  @centolaComplexContagionsWeakness2007's large contribution was the theorizing
  of complex contagions, those that require "independent affirmation or
  reinforcement from multiple sources" (p 703) and is not based on the number of
  exposures but the number of sources of exposure. In the case of behavioral
  contagion, this means that the behavior must be reinforced through witnessing
  multiple alters perform this behavior before contagion can take effect.

In the case of stay-at-home rates or vaccination rates, this theoretically means
that a person exposed to many sources of the same signal (high, medium, low
rates) will be more likely to adopt the behavior based on the reinforcement from
the multiple sources of exposure. As norms are inherently social, I theorize
that we can see complex contagion happening in real time with the following
hypothesis:


(@)  _Hypothesis 3_ increased average time spent in residence (signal direction) from alters will have a positive effect on time spent in residence for the ego-county; increase vaccine uptake by alters will have a positive effect on vaccine uptake for the ego-county


To make the contagion more complex, different sources of exposure
(county-alters) adhere to CDC recommendations to stay-at-home at differing
rates. Whereas one county-alter may be greatly increasing its time in residence,
another may have made little change. When the majority of alters is in
concordance with each other, the signal to the ego is reinforced and more
impactful on the ego. When these signals are mixed with high variance from
different sources, agreement is low and makes the behavioral change less likely.
For this paper, I theorize that a new concept of 'Discordance' must be
considered as impacting complex contagion. Discordance is the variance of
signals received by an alter; high discordance prevents reinforcement while low
discordance enables complex contagion. Instead of adopting a 'majority' rules
attitude, this means that the more Discordance perceived by an ego, the less
likely the alters will have any effect on the ego. I theorize that the behavior
of a county-alter will be positively correlated with the behavior of another
county-ego if the county-ego receives highly discordant signals.

(@)  _Hypothesis 4_ the effect of signal direction on time spent in residence and vaccine uptake will be moderated by diversity in signals (discordance)

<!-- TODO update figure to read discordance not assortativity -->

```{r dag, fig.cap='Proposed Elaboratory Theoretical Model', out.width='50%'}
knitr::include_graphics(here('figs/dag.png'))
```


### Associative Diffusion

While much of the social contagion literature, like the theories above, focuses
on structural boundaries and homophily as causes of how diffusion occurs,
Goldberg and Stein (-@goldbergSocialContagionAssociative2018) propose a disrupting alternative mechanism. They argue
that what actually diffuses during social contagion are the perceptions about
which beliefs or behaviors are compatible with one another, what they call
“associative diffusion.” This argument that culture does not spread like a virus
but instead is dependent on how belief structures are connected to each other is
important to test because norms around health behaviors became politicized
issues during the Covid-19 pandemic. This means that the population mobility
behavior itself was not contagious, but the cognitive association of social
distancing or vaccination uptake meant were spreading between populations of
individuals. While this cognitive theory of cultural variation is difficult to
test, the theory it supplies provides a solid framework for how behavioral norms
formed during the pandemic.

```{r norm-framework, fig.cap='Preliminary model of norm formation'}
knitr::include_graphics(here('figs/model.png'))
```

The figure above illustrates how I interpret associative diffusion will impact
population movement and vaccination rates in times of unsettled norms. An
individual enters this framework when they realize they don’t have a normative
set of responses in their cultural toolkit to respond to an unfamiliar situation
they are presented with. Individuals look to norms to regulate behavior, avoid
deviance, and to maintain order [@horneNormsIntegratedFramework2020;
@shepherdStructurePerceptionHow2017]; when they don’t have a normative behavior
to follow (or rebel against), individuals look to the other sources in their
“community” to mimic behavior, such as high-status individuals, institutions,
and members of their social network. I theorize that individuals look towards
their physical community, to their social network, popular media (which may
include government and science recommendations), established norms that they may
find online through search, and to the real threat of infection (what would
happen if I do nothing about this norm). Following both the Integrated
Theoretical Framework of Norms [@horneNormsIntegratedFramework2020] and
associative diffusion [@dellapostaWhyLiberalsDrink2015;
@goldbergSocialContagionAssociative2018], I theorize that the viewing and
interpretation of what is viewed by the ego of their “community” is filtered
through their cognitive biases and behavioral predispositions to determine their
formation of new behavioral norms.

There is some evidence I can draw upon to support the associative diffusion
fraemwork. For instance, there is a central conflict between religious and
scientific ideologies which I theorize leads more religious counties to reject
the stay-at-home order and vaccines [@evansReligionScienceEpistemological2008] because the associative
diffusion places public health recommendations against realigious ideologies.
Furthermore, as COVID-19 has become a politically polarizing issue, conservative
ideology and a general mistrust of “big government” [@frank2007s] are likely to
lead to resistance to the government and scientific guidance.

# Objectives and Significance of the Study

<!-- add to contribution - new concept of discordance, measurement of complex contagion, meso-level networks -->

This paper is an important contribution to a few different fields. It
contributes to the literature on social influence and contagion, as social
connectedness of counties will impact regional population mobility. Moreover,
using a aggregated community-level analysis presents a unique test of the
contagion literature. Finally, looking at the diffusion of high-risk health
behaviors will be an important contribution to public health and social
epedimiology.

Unlike many observations of social networks that mediate between questions of
influence and self-selection [@lewisSocialSelectionPeer2012], this project is unique because
self-selection is a precondition to the natural experiment of the virus. I will
control for various demographic differences in county, allowing for an isolation
of behavioral change during the study period.


# Data and Methods
This article draws on two unique longitudinal datasets that I
compiled for this analysis from sources like Facebook, Google, CDC, etc.

## Stay at Home Rates

My first dependent variable aims to operationalize behavioral norms as
stay-at-home rates with data from Google [@google2020a]. While the Google
COVID-19 Community Mobility Reports include multiple measures of mobility based
on location and activity information, the change in time spent in Residences
most closely aligns to an operationalization of an obedience to CDC and governor
orders, a new and emerging norm in 2020. The change in time spent in Residences
variable represents percent change of time spent from Google Location History
within geographic areas that Google has designated as a residential area. These
data are aggregated to the county-level based on anonymized sets of data from
users who have turned on the Location History setting, which is off by default.
Google calculates the relative change in mobility in comparison to the median
value of movement in the area for the same the corresponding day of the week,
during the 5-week period Jan 3–Feb 6, 2020. As Google did not provide data on
certain US counties if they did not have sufficient statistically significant
levels of data, my final county sample is _n_ = `r google %>% count(FIPS) %>% nrow()`
(compared to the total population of 3,107 US counties). Particular areas that
are excluded in this analysis include all counties in Alaska and DC, and over
half of the counties in North Dakota, South Dakota, and a few other counties.
Full list of excluded counties available upon request. These data are
longitudinal measures calculated by creating a moving average of stay-at-home
rates for each county (rolling window width = 7 days) and then sampling every
Monday in the sample for 44 measures from March 02, 2020 through December 28,
2020.

```{r, include = FALSE, eval = FALSE}
included = google %>% count(FIPS) %>% pull(FIPS)
count_to_state %>% 
  mutate(in_data = ifelse(FIPS %in% included, TRUE, FALSE)) %>% 
  count(state_abbr, in_data) %>%
  pivot_wider(id_cols = state_abbr,
              names_from = in_data,
              values_from = n,
              values_fill = 0) %>%
  mutate(percent_missing = `FALSE` / (`FALSE` + `TRUE`)) %>% 
  arrange(-percent_missing)
```


```{r google-desc-table, results = "asis"}
counties <- google %>% count(FIPS) %>% pull(FIPS)
google_dates <- google %>% count(date) %>% pull(date)

google %>% 
  select(SAH,p_white,p_college,perc_65_over,income_med,unemployed_rate,trump_votes_2016,
         evangelical_county,fox_news,case_rate,
         week_num, sci_prob_self,movement_signal,movement_assor) %>% 
  as.data.frame() %>% 
  stargazer(., 
          title ="Descriptive Statistics for Stay at Home Models (county-level)",
          label = 'google-desc-table',
          covariate.labels = c(
            "Stay at Home Rate, Change from Baseline",
            "Percent White",
            "Percent College Graduates",
            "Percent over 65",
            "Median Income",
            "5 Year-Unemployment Rate",
            "Percent of GOP votes, 2016",
            "Percent Evangelical Christian",
            "Fox News Interest",
            "Covid Case Rate",
            "Week Number",
            "Community Integration",
            "Movement Signal",
            "Movement Discordance"),
          # type = "text", 
          summary = TRUE,
          rownames = TRUE,
          summary.stat = c("min", "max", "mean", "sd"),
          digits = 2,
          header=FALSE,
          notes =c(glue("Notes: {format(length(counties), nsmall=1, big.mark=',')} counties, {format( min(google_dates), '%B %d')} through {format(max(google_dates), '%B %d')}, 2020."),"Raw values presented in table. Values in models are normalized."))

```

```{r plot-google, cache = TRUE, fig.cap = "Stay-at-Home over Time", out.width="80%"}
plot_google <- vroom::vroom(here("data","covid-mobility", "2020_US_Region_Mobility_Report.csv"), show_col_types = FALSE)  %>%
  drop_na(census_fips_code) %>% 
  select(date, FIPS = census_fips_code, SAH = residential_percent_change_from_baseline) %>% 
  filter(!is.na(FIPS)) %>%
  complete(date, FIPS)  %>% 
  group_by(FIPS) %>%
  mutate(sumNA = sum(ifelse(is.na(SAH), 1, 0))) %>% 
  filter(sumNA < 200) %>% 
  fill(SAH, .direction = 'downup') %>%
  filter(!is.na(SAH)) %>% 
  mutate(SAH = zoo::rollmean(SAH, k = 7, fill = "extend"))  %>% 
  ggplot(aes(x=date, y=SAH)) +
  geom_line(aes(group=FIPS), color = my_palette[2]) + 
  geom_smooth(color = my_palette[1]) +
  theme_minimal() +
  labs(caption = 'Data from the Google Community Mobility Report',
       x = '', 
       y = 'Stay-at-Home Rate, Percent change from baseline') +
  theme(plot.title.position = "plot")

ggsave(filename = here('figs/plot-google.png'), plot_google)

knitr::include_graphics(here('figs/plot-google.png'))
```
		

## COVID vaccination uptake

The second dependent variable aims to operationalize vaccination uptake through
vaccination rate information in the United States from January 2021 through
August 30 2021 [@cdcCOVID19Vaccination2021]. Data represents all vaccine partners including
jurisdictional partner clinics, retail pharmacies, long-term care facilities,
dialysis centers, Federal Emergency Management Agency and Health Resources and
Services Administration partner sites, and federal entity facilities.
Vaccination data is available for all US counties with the exception of parts of
California and Massachusetts, Hawaii, Texas. In Texas and Hawaii, no county
level information is available, and California does not report the county of
residence for vaccinations when the county of residence has a population less
than 20,000 people. Finally,Massachusetts does not provide vaccination data for
Barnstable, Dukes, and Nantucket counties because of their small populations.
Therefore, my final county sample for vaccination rates is _n_ = `r vacc %>% count(FIPS) %>% nrow()` 
(compared to the total population of 3,107 US counties). A list of included FIPS
are available upon request. Vaccination rates are scaled with a rolling mean
with a rolling window width of seven days to smooth out inter-week noise. I
sample every Monday between January 2021 through August 30 2021 for 35 total
observations for each county.

- https://www.cdc.gov/coronavirus/2019-ncov/vaccines/distributing/reporting-counties.html
- https://data.cdc.gov/Vaccinations/COVID-19-Vaccinations-in-the-United-States-County/8xkx-amqh

```{r vacc-desc-table, results = "asis"}
counties <- vacc %>% count(FIPS) %>% pull(FIPS)
vacc_dates <- vacc %>% count(date) %>% pull(date)

vacc %>% 
  select(vacc_rate,p_white,p_college,perc_65_over,                              income_med,unemployed_rate,trump_votes_2020,
         evangelical_county,fox_news,case_rate,
         week_num, sci_prob_self,vacc_signal,vacc_assor) %>% 
  as.data.frame() %>% 
  stargazer(., 
          title ="Descriptive Statistics for Vaccination Models (county-level)",
          label = 'vacc-desc-table',
          covariate.labels = c(
            "Vaccination Rate, Percent",
            "Percent White",
            "Percent College Graduates",
            "Percent over 65",
            "Median Income",
            "5 Year-Unemployment Rate",
            "Percent of GOP votes, 2020",
            "Percent Evangelical Christian",
            "Fox News Interest",
            "Covid Case Rate",
            "Week Number",
            "Community Integration",
            "Vaccination Signal",
            "Vaccination Discordance"),
          # type = "text",
          summary = TRUE,
          rownames = TRUE,
          summary.stat = c("min", "max", "mean", "sd"),
          digits = 2,
          header=FALSE,
          notes = c(glue("Notes: {format(length(counties), nsmall=1, big.mark=',')} counties, {format( min(vacc_dates), '%B %d')} through {format( max(vacc_dates), '%B %d')}, 2021."),"Raw values presented in table. Values in Models are normalized."))

```

```{r plot-vacc, cache = TRUE, fig.cap = "Vaccination Rates over Time", out.width="80%"}



plot_vacc <- vroom::vroom(here("data","vaccination-rates", "COVID-19_Vaccinations_in_the_United_States_County.csv"), show_col_types = FALSE) %>% 
  mutate(date = lubridate::mdy(Date, quiet = TRUE)) %>% 
  select(FIPS, date, vacc_rate = Series_Complete_Pop_Pct) %>% 
  left_join(count_to_state, by = "FIPS") %>% 
  filter( ! (state_abbr %in% c("HI", "TX")),
          ! (FIPS %in% c('25001', '25007', '25019')),
          ! (FIPS %in% c("06003","06027", "06043", "06049", "06051", "06063", "06091", "06105")),
          (FIPS != 'UNK')) %>% 
  complete(date, FIPS)  %>% 
  group_by(FIPS) %>%
  mutate(vacc_rate = zoo::rollmean(vacc_rate, k = 7, fill = NA)) %>% 
  ggplot(aes(x=date, y=vacc_rate)) +
  geom_line(aes(group=FIPS), color = my_palette[2]) + 
  geom_smooth(color = my_palette[1]) +
  theme_minimal() +
  labs(caption = 'Data from the CDC',
       x = '2021 Date', 
       y = 'Vaccination Rate') +
  theme(plot.title.position = "plot")

ggsave(filename = here('figs/plot-vacc.png'), plot_vacc)

knitr::include_graphics(here('figs/plot-vacc.png'))
```


## Independent Variables

### Community Integration
This project will also draw on the "Social Connectedness Index" [@Bailey2018;
@facebook20] which indexes the social links between geographies by the
likelihood of Facebook friends. It is an aggregated measure of Facebook
friendship connections between counties. It corresponds to “the (relative)
probability that two arbitrary Facebook users across two geographies are friends
with each other". The data is available at various geographic aggregation
levels, such as U.S. zip codes or entire countries. This measure is based on
user-provided information and real-time location-service data gathered by
Facebook. The data has been tested to show how initial COVID-19 hotspots are
related to subsequent virus spread to non-hotspots, even after controlling for
population density and geographic distance [@Kuchler2020]. For this project, I
first use the Social Connectedness Index to measure how likely it is that two
Facebook users within a county are friends with each other; in other words, how
tightly knit is the broader community.

<!-- mention that this is a stable statistic over time -->
```{r sci, fig.cap='Relative Probability of Link to SF County, CA (Bailey et al. 2018)', include=FALSE}
knitr::include_graphics(here('figs/sci-prob.png'))
```

### Network signal

Secondly, I utilize the likelihood of a friendship connection between counties
to create a county-level social network weighted by the probability of a tie.
Using this network and the two independent variables above, I examine how the
vaccination and stay-at-home rates of peer counties is contagious to the
ego-county. To do this, I first take the weighted average of each ego's network
signals using the equation \@ref(eq:networksignal) where `x` denotes the
vaccination and stay-at-home rates of each alter county and `w` represents the
likelihood of a friendship connection between the ego county and each of their
alters, lagged by one week. This 'signal' of norms gives us insight into the
coevolving contagion patterns of the new social norm being established.

\begin{equation}
signal = \frac{\sum_{i=1}^nw_ix_i}{\sum^n_{i=1}w_i} (\#eq:networksignal)
\end{equation}

### Signal Discordance

The third independent variable, _Signal Discordance_, builds on the network
signal but looks specifically at the extent to which a given ego-network
receives diverse contagion signals. Based on the hypothesis that when the
majority of alters is in concordance with each other, the signal to the ego is
reinforced and more impactful on the ego, a high discordance coefficient is
indicative of diverse signals which may prevent any clear interpretation of a
norm developing, whereas a low discordance coefficient would indicate reinforced
signaling. I use the formula to calculate weighted standard deviations, (see equation
\@ref(eq:signaldiscordance)) to provide a metric of a diversity of signals. In
this formula, `x` denotes the vaccination and stay-at-home rates of each alter
county and `w` represents the likelihood of a friendship connection between the
ego county and each of their alters, lagged by one week. Furthermore, $\bar{x}^*$ 
represents the weighted mean. 

\begin{equation}
discordance = \sqrt{\frac{\sum_{i=1}^nw_i(x_i-\bar{x}^*)^2}{\sum^n_{i=1}w_i}} (\#eq:signaldiscordance)
\end{equation}

Figure \@ref(fig:assortativity-vacc) provides a visualization of both network signal
and signal discordance for April 26, 2021 for 7 selected counties. While a
county like Lake County, Ohio has low discordance meaning the signal of vaccination
rate is reinforced, Navajo County, Arizona receives very diverse signals from
their county-alters, negating any contagion effects.


```{r discordance_extra_data_load}
sample = c("08003", '55057', '51059', '39085', 
           # '36119',
           '34021', '12071', '04017' )

sci <- readr::read_tsv(here('data', 'social-connectedness', 'county_county.tsv') ) %>% 
  mutate(scaled_sci = scaled_sci/1000000000) %>%
  filter(scaled_sci > 0.00001)

count_to_state <- read_csv("https://raw.githubusercontent.com/kjhealy/fips-codes/master/county_fips_master.csv") %>% 
  mutate(FIPS = str_pad(fips, 5, pad = "0"),
        name = paste0(county_name,", " ,state_abbr)) %>% 
  select(FIPS, name)
```

```{r assortativity-google, dependson=c('load_google','discordance_extra_data_load'), include=FALSE, eval = FALSE}

plot1a_data <- google %>% 
  dplyr::filter(date == lubridate::ymd("2020-04-06")) %>%
  left_join(count_to_state, by = "FIPS") %>% 
  mutate(name = ifelse(FIPS %in% sample, name, NA_character_),
         size= ifelse(FIPS %in% sample, 2, 1),
         alpha= ifelse(FIPS %in% sample, 1, .5)) 

plot1a <- ggplot() + 
  #background points)
  geom_point(data = filter(plot1a_data, is.na(name)), 
             aes(x = movement_signal, y = movement_assor), 
             size = 1,
             alpha = .25,
             color = 'grey') + 
  #highlighted points
  geom_point(data = filter(plot1a_data, !is.na(name)), 
             aes(x = movement_signal, y = movement_assor, color = fct_reorder(name,movement_assor)),
             size = 4,
             alpha = 1) +
  geom_text(data = filter(plot1a_data, !is.na(name)),
            aes(x = movement_signal, 
                y = movement_assor, 
                label =  fct_reorder(name,movement_assor),
                color =  fct_reorder(name,movement_assor)), 
            size = 3,
            vjust = -1,
            hjust = -0.15) + 
  theme_minimal() +
  theme(legend.position = 'none',
        plot.title.position = "plot",
        plot.title = element_text(size=10)) +
  scale_fill_manual(values=my_palette[1:7]) +
  scale_color_manual(values=my_palette[1:7]) +
  labs(title = 'Scatterplot of Signals and Discordance with 7 counties highlighted',
       x = 'Stay at Home Signals', y = 'Signal Discordance')

plot1b_data <- vroom::vroom(here("data","covid-mobility", "2020_US_Region_Mobility_Report.csv"), 
                            show_col_types = FALSE)  %>% 
  drop_na(census_fips_code) %>% 
  select(date, FIPS = census_fips_code, SAH = residential_percent_change_from_baseline) %>% 
  filter(!is.na(FIPS)) %>%
  group_by(FIPS) %>%
  mutate(SAH = tidyr::replace_na(SAH, 0),
         SAH = zoo::rollmean(SAH, k = 7, fill = NA),
         wday = lubridate::wday(date, label=TRUE)) %>% 
  filter(wday == "Mon",
         !is.na(SAH)) %>% 
  select(FIPS, date, SAH) %>% 
  ungroup()  

plot1b_data <- plot1b_data %>% 
  filter(FIPS %in% sample,
         date == lubridate::ymd("2020-04-06")) %>%
  select(-SAH) %>% 
  dplyr::mutate(date_lag = date - 7) %>% 
  dplyr::left_join(sci, by = c("FIPS" = "user_loc")) %>%     
  dplyr::left_join(plot1b_data, by = c(c("fr_loc" = "FIPS"),
                                       c("date_lag" = "date"))) %>%
  left_join(count_to_state, by = "FIPS") %>% 
  left_join(select(google, FIPS, date, movement_signal, movement_assor), by = c('date', 'FIPS'))

plot1b <- plot1b_data %>% 
  mutate(name = fct_reorder(name, movement_assor)) %>% 
  filter(FIPS != fr_loc) %>% 
  ggplot() + 
  geom_density_ridges(aes(x = SAH, y = name, fill = name, weight = scaled_sci, height=..density..), 
                      alpha = 0.5, show.legend = FALSE, color = NA,
                      stat='density') +
  geom_segment(aes(x = (movement_signal - movement_assor) , 
                   xend = (movement_signal + movement_assor),
                   y = name, 
                   yend = name), lineend = 'butt', size = 2,
               show.legend = FALSE, alpha = 0.6, color = '#4c4c4c') +
  geom_point(aes(x = movement_signal, y = name, color = name), 
             size = 3, show.legend = FALSE) +
  geom_point(aes(x = movement_signal, y = name), size = 1, 
             color = '#4c4c4c', show.legend = FALSE, alpha = 0.6) +
  theme_minimal() +
  theme(plot.title.position = "plot",
        plot.title = element_text(size=10),
        plot.subtitle = element_text(size = 8)) +
  labs(x = 'Stay at Home Signals', y = '',
       title = 'Raw distribution of Stay at Home Signals per county with the weighted average and standard deviation highlighted',
       subtitle = 'Colored Point = Weighted Mean; Grey line = Weighted SD or spread of signals',
       caption = 'Weighted density plot, weighted by likelihood of Facebook Friendship connection')  +
  scale_fill_manual(values=my_palette[1:7]) +
  scale_color_manual(values=my_palette[1:7]) 
  

```

```{r assortativity-vacc, dependson=c('load_vacc','discordance_extra_data_load'), cache = TRUE, fig.cap = 'How Signal Mean and Signal Assortativity are Measured', out.width="90%"}

plot1c_data <- vacc %>% 
  dplyr::filter(date == lubridate::ymd("2021-04-26")) %>%
  left_join(count_to_state, by = "FIPS") %>% 
  mutate(name = ifelse(FIPS %in% sample, name, NA_character_),
         size= ifelse(FIPS %in% sample, 2, 1),
         alpha= ifelse(FIPS %in% sample, 1, .5)) 

plot1c <- ggplot() + 
  #background points)
  geom_point(data = filter(plot1c_data, is.na(name)), 
             aes(x = vacc_signal, y = vacc_assor), 
             size = 1,
             alpha = .25,
             color = 'grey') + 
  #highlighted points
  geom_point(data = filter(plot1c_data, !is.na(name)), 
             aes(x = vacc_signal, y = vacc_assor, color = fct_reorder(name,vacc_assor)),
             size = 4,
             alpha = 1) +
  geom_text(data = filter(plot1c_data, !is.na(name)),
            aes(x = vacc_signal, 
                y =vacc_assor, 
                label =  fct_reorder(name,vacc_assor),
                color =  fct_reorder(name,vacc_assor)), 
            size = 3,
            vjust = -1,
            hjust = -0.15) + 
  theme_minimal() +
  theme(legend.position = 'none',
        plot.title.position = "plot",
        plot.title = element_text(size=10),
        plot.subtitle = element_text(size = 8),
        plot.caption = element_text(size = 6),
        axis.title = element_text(size = 8),
        axis.text = element_text(size = 6)) +
  scale_fill_manual(values=my_palette[1:7]) +
  scale_color_manual(values=my_palette[1:7]) +
  labs(title = 'Scatterplot of Signals and Discordance with 7 counties highlighted',
       x = 'Vaccination Signals', y = 'Signal Discordance')

plot1d_data <- tibble(FIPS = sample, date = lubridate::ymd("2021-04-26")) %>% 
  dplyr::mutate(date_lag = date - 7) %>% 
  dplyr::left_join(sci, by = c("FIPS" = "user_loc")) %>%     
  dplyr::inner_join(select(vacc, date, FIPS, vacc_rate), by = c(c("fr_loc" = "FIPS"),
                                       c("date_lag" = "date"))) %>%
  left_join(count_to_state, by = "FIPS") %>% 
  left_join(select(vacc, FIPS, date, vacc_signal, vacc_assor), by = c('date', 'FIPS'))

plot1d <- plot1d_data %>% 
  mutate(name = fct_reorder(name, vacc_assor)) %>% 
  filter(FIPS != fr_loc) %>% 
  ggplot() + 
  geom_density_ridges(aes(x = vacc_rate, y = name, fill = name, weight = scaled_sci, height=..density..), 
                      alpha = 0.5, show.legend = FALSE, color = NA,
                      stat='density') +
  geom_segment(aes(x = (vacc_signal - vacc_assor) , 
                   xend = (vacc_signal + vacc_assor),
                   y = name, 
                   yend = name), lineend = 'butt', size = 2,
               show.legend = FALSE, alpha = 0.6, color = '#4c4c4c') +
  geom_point(aes(x = vacc_signal, y = name, color = name), 
             size = 3, show.legend = FALSE) +
  geom_point(aes(x = vacc_signal, y = name), size = 1, 
             color = '#4c4c4c', show.legend = FALSE, alpha = 0.6) +
  theme_minimal() +
  labs(x = 'Vaccination Signals', y = '',
       title = 'Weighted Densities of Vaccination Signals per county with weighted average\nand standard deviation highlighted',
       subtitle = 'Colored Point = Weighted average; Grey line = Weighted SD, i.e. Discordance',
       caption = 'Densities Weighted by likelihood of Facebook Friendship connection')  +
    theme(plot.title.position = "plot",
        plot.title = element_text(size=10),
        plot.subtitle = element_text(size = 8),
        plot.caption = element_text(size = 6),
        axis.title = element_text(size = 8),
        axis.text = element_text(size = 6)) +
  scale_fill_manual(values=my_palette[1:7]) +
  scale_color_manual(values=my_palette[1:7]) 
  
assort_plot <- plot1c/plot1d
# +   plot_annotation(title = '')

ggsave(filename = here('figs/assort_plot.png'), assort_plot, width = 7, height = 9)

knitr::include_graphics(here('figs/assort_plot.png'))
```


### Case Rate
To estimate the concept of 'real threat of infection' in figure \@ref(fig:norm-framework), the
models use county-level Covid-19 case rates with data from @thenewyorktimes21.
It is widely acknowledged that there are biases in this data due to
inconsistencies and availability in testing as well as different community
propensity to test (TODO CITE). However, it is the best measure we have of
actual case rates. County data are scaled with a rolling mean with a rolling
window width of seven days to smooth out inter-week noise. Case Rate is measured
as number of cases per 100,000 population. Observations vary from 0 to 1,565
between the two datasets.

### Pillars of Convervatism
Research has shown that stay-at-home rates and other pandemic health behaviors
are related to various 'pillars of conservatism' [@hillBloodChristCompels2020;
@hillNastiestQuestionDoes2021; @hillLoveThyAged2021;
@gonzalez_etal21]. Namely, research shows that
politically conservative indicators, such as  Republican political leadership,
conservative Protestantism and consumption of right-wing media are related to
higher rates of movement and lower rates of mask usage. Based on these findings,
this article controls for these factors in the following ways: to measure
Republican political leadership, I include percentage of votes for Donald Trump
in the previous presidential election; for the 2020 study, I use the 2016
results and for the 2021 study, I use the 2020 results to infer proper time
ordering. Second, to measure conservative Protestantism with the county’s
percentage of evangelical Christians. These county-level data were collected
through the 2010 U.S. Religion Census: Religious Congregations and Membership
Study [@grammich_etal18]. Finally, right-wing media consumption is assessed
using Google Search Trends to capture “Fox News” searches over the study period
across individual designated media markets areas (DMAs), a nonoverlapping
aggregation of U.S. counties to 210 media markets based on similar population
clusters. Each DMA value represents the popularity of the search term on a scale
of 0 to 100, with 100 being the maximum search popularity out of all DMAs and
all searches. We use this measure to indicate active interest in and attention
toward Fox News. Google Search Trends have been validated for use in a range of
research contexts and for use with survey data, voting data, and ecological data
[@bailPrestigeProximityPrejudice2019; @reyesUsingInternetSearch2018;
@scheitleGoogleInsightsSearch2011; @stephens-davidowitzCostRacialAnimus2014;
@swearingenGoogleInsightsSenate2014].

### Demographics

These models also control for (1) percent of the population that is above 65
years old (those most at risk of hospitalization), (2) percent of the population
that identifies as white, (3) percent of the population that holds a college
degree, (4) median income, and (5) monthly county unemployment rate. Measures 1
through 4 are obtained from the 2018 American Community Survey: 5-Year Estimates
[@uscensusbureauAmericanCommunitySurvey2018]; unemployment rates are gathered
from the U.S. Bureau of Labor Statistics [@labor2020a].


## Modeling Prodecures

```{r google_models, dependson='load_google', cache = TRUE}
google <- google %>% 
  mutate(across(SAH:fox_news, ~ scale(., center=TRUE, scale=TRUE)))

google_h1 = lme(fixed = SAH ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
               trump_votes_2016 +  evangelical_county + fox_news+
                 case_rate + week_num, 
             random = ~ week_num | FIPS, 
             data = google,
             correlation = corAR1(), 
             control = lmeControl(opt = "optim"))

google_h2 <- lme(fixed = SAH ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
               trump_votes_2016 +   evangelical_county + fox_news+
                case_rate + week_num + sci_prob_self, 
             random = ~ week_num | FIPS, 
             data = google,
             correlation = corAR1(), 
             control = lmeControl(opt = "optim"))

google_h3 <- lme(fixed = SAH ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
               trump_votes_2016 +  evangelical_county + fox_news+
               case_rate + week_num + movement_signal*week_num, 
             random = ~ (week_num*movement_signal)| FIPS, 
             data = google,
             correlation = corAR1(), 
             control = lmeControl(opt = "optim"))

google_h4 <- lme(fixed = SAH ~ p_white + p_college + perc_65_over +
                  income_med + unemployed_rate +
               trump_votes_2016 + evangelical_county + fox_news+
                 case_rate + week_num + 
                 movement_signal*week_num +
                 movement_signal*movement_assor, 
             random = ~ (week_num * movement_signal)| FIPS, 
             data = google,
             correlation = corAR1(), 
             control = lmeControl(opt = "optim"))

```

```{r vacc_models, dependson='load_vacc', cache = TRUE, include = FALSE, eval = FALSE, eval = FALSE}
vacc <- vacc %>% 
  mutate(across(vacc_rate:week_num, ~(scale(.,scale = T, center = T)))) 


vacc_h1 <- lme(fixed = vacc_rate ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                 # evangelical_county + 
                 trump_votes_2020 + fox_news+
               case_rate + week_num, 
             random = ~ week_num | FIPS, 
             data = vacc,
             correlation = corAR1(), 
             control = lmeControl(opt = "optim"))

vacc_h2 <- lme(fixed = vacc_rate ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                trump_votes_2020 + 
                 # evangelical_county + 
                 fox_news+
               case_rate + week_num + sci_prob_self, 
             random = ~ week_num | FIPS, 
             data = vacc,
             correlation = corAR1(), 
             control = lmeControl(opt = "optim"))

vacc_h3 <- lme(fixed = vacc_rate ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                trump_votes_2020 +  
                 # evangelical_county + 
                 fox_news+
                case_rate + vacc_signal*week_num, 
             random = ~ (week_num*vacc_signal)| FIPS, 
             data = vacc,
             correlation = corAR1(), 
             control = lmeControl(opt = "optim"))

vacc_h4 <- lme(fixed = vacc_rate ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                trump_votes_2020 +  
                 # evangelical_county + 
                 fox_news+
                case_rate + vacc_signal*week_num + vacc_signal*vacc_assor, 
             random = ~ (week_num*vacc_signal)| FIPS, 
             data = vacc,
             correlation = corAR1(), 
             control = lmeControl(opt = "optim"))
```

For each case study, I employ a series of four linear mixed effects regression
models to address hypotheses 1 through 4. Linear mixed effects models are a form
of hierarchical linear models that contain both random and fixed effects. These
models treat the dependent variables as continous. The following strategies I
will outline are identical for both case studies. Each model utilizes normalized
independent variables, i.e. variables that have been centered and scaled to have
a mean of 0 and standard deviation 1. The first model is a baseline linear mixed
effects model that employs all basic controls to predict the dependent variable,
allowing both time-varying and county-level variables to predict the outcome.
All variables have fixed effect per county with the exception of time, which is
specified as a random effect within county. This model will address Hypothesis
1. To test hypothesis 2, I estimate model 2 which builds on model 1 by adding
the a measure of Community Integration, or, how likely it is that two Facebook
users within a county are friends with each other. Models 3 tests hypothesis 3
builds on model 1 by first introducing signal. Because the signal varies by
week, I estimate this model with an interaction between week and signal.
Moreoever, because signal may have different effects across different counties,
I set a random effect for both signal, week, and the interaction between signal
and week. A visual representation of this interaction can be seen in figures
\@ref(fig:plot-google-h3) and \@ref(fig:plot-vacc-h3). Model 4 then builds on
model 3, introducing a fixed effect for the interaction between signal and
discordance. Model 4 tests hypothesis 4. Figures \@ref(fig:plot-google-h4) and
\@ref(fig:plot-vacc-h4) depict how signal and discordance interact.


# Results

## Stay at Home results

```{r google-tables, dependson='google_models', cache = TRUE,  results = 'asis' }

# TODO labels / order out of order

stargazer(
  google_h1, google_h2, google_h3, google_h4,
  title="Linear Mixed Effects Regression Results for Stay At Home Rates", 
  dep.var.labels = "Stay at Home rate",
   order=c(1,2,3,4,5,6,7,8,9,10,11,12,14,13, 15),
  covariate.labels = c(
    "Percent White",
    "Percent College Graduates",
    "Percent over 65",
    "Median Income",
    "Monthly Unemployment Rate",
    "Percent of GOP votes, 2016",
    "Percent Evangelical Christian",
    "Fox News Interest",
    "Covid Case Rate",
    "Week Number",
    "Community Integration",
    "Movement Signal",
    "Movement Signal x Week",
    "Movement Discordance",
    "Movement Signal x Movement Discordance"),
  align = TRUE,
  # type = "html",
  # type = "text",
  star.cutoffs = c(.05, .01, .001), 
  no.space = T, 
  digits = 2,
  header=FALSE,
  omit.stat = c("f", 'll', 'aic', 'bic',"ser", "rsq","adj.rsq"),
  # column.sep.width = "-15pt",
  # single.row = TRUE,
  font.size = "small",
  label = "google_results",
  omit = "Constant",
  notes= c('Models 1-4 include a random effect for Week Number by FIPS,',
           'Models 3-4 include a random effect for the interaction of Movement Signal and Week by FIPS' ))

```


1. Hypothesis 1 Relatively higher local rates of infection will lead to increased time spent in residence

The parameter phi is .95, which is a good indicator that adjacent time points for each person are related. References: Finch, W. H., Bolin, J. E., & Kelley, K. (2014). Multilevel modeling using R. Crc Press.

\@ref(tab:google_results)

2. Hypothesis 2 Having a low percent of Facebook friends living outside of the county will not lead to an increase in time spent in residence

Super strong negative correlation of community integration, (likelihood #
people from the same county would be connected), indicating that the stronger #
community self-integration, the less likely to stay home, regardless of #
religious and political affiliation.

may need to run again population density or population to make sure this is
valid


```{r plot-google-h3, dependson='google_models', cache = TRUE, fig.cap='Predicted Values of Stay at Home Rate by Movement Signal', out.width="80%"}
pred2 <- ggpredict(google_h3, c("week_num", "movement_signal")) %>% as_tibble()

pred2 <- pred2 %>% 
  mutate(group = case_when(group == 1 ~ "High",
                           group == 0 ~ "Average",
                           group == -1 ~ "Low"),
         group = fct_relevel(group, c("Low", "Average", "High"))) %>% 
  ggplot(aes(x = x, y = predicted, color = group, fill = group)) + 
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high),alpha = 0.5,color = NA) + 
  geom_line() + 
  theme_minimal() + 
  labs(subtitle='Interaction of Week Number by Movement Signal',
       x = "Week Number", 
       y = "Stay at Home Rate (Change from Baseline)",
       fill = "Movement Signal", 
       color = "Movement Signal") +
  scale_fill_manual(values=my_palette[1:3]) +
  scale_color_manual(values=my_palette[1:3]) +
  theme(plot.title.position = "plot")
ggsave(filename = here('figs/plot-google-h3.png'), pred2)

knitr::include_graphics(here('figs/plot-google-h3.png'))

```

3. Hypothesis 3 increased average time spent in residence (signal direction) from alters will have a positive effect on time spent in residence for the ego-county

So if you SEE your friends moving around more, you start staying at home more. ~
Righteous superiority. If you see people staying at home, you assume it’s safer
and then start moving around more.

See Figure \@ref(fig:plot-google-h3).

```{r plot-google-h4, dependson='google_models', cache = TRUE, fig.cap='Predicted Values of Stay at Home Rate Moderated', out.width="80%"}
pred3 <- ggpredict(google_h4, c("movement_signal", "movement_assor")) %>% as_tibble()
pred3 <- pred3 %>% 
  mutate(group = case_when(group == 1 ~ "Discordance",
                           group == 0 ~ "Average",
                           group == -1 ~ "Concordance"),
         group = fct_relevel(group, c("Discordance", "Average", "Concordance"))) %>% 
  ggplot(aes(x = x, y = predicted, color = group, fill = group)) + 
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.5, color = NA) + 
  geom_line() + 
  theme_minimal() + 
  labs(subtitle='Interaction of Movement Signal by Movement Discordance',
       x = "Movement Signal",
       y = "Stay at Home Rate (Change from Baseline)",
       fill = "Movement\nDiscordance",
       color = "Movement\nDiscordance") +
  scale_fill_manual(values=my_palette[1:3]) +
  scale_color_manual(values=my_palette[1:3]) +
  theme(plot.title.position = "plot")

ggsave(filename = here('figs/plot-google-h4.png'), pred3)

knitr::include_graphics(here('figs/plot-google-h4.png'))
```
4. Hypothesis 4 the effect of signal direction on time spent in residence will be moderated by diversity in signals (Discordance)

high Discordance = completely moderates the social influence effect
low Discordance , condensed signal = allows for social influence to have an effect

High signal Discordance moderates the effects of the signal. Explicitly, if
a county is receiving a wide array of low and high signals, their stay at home
rates won't be affected. When a signal is concentrated or in agreement, the
theoretical effect of movement signaling on the ego are the strongest.

See Figure \@ref(fig:plot-google-h4).

## vaccines results

```{r vacc-tables, dependson='vacc_models', cache = TRUE, results = 'asis', include = FALSE, eval = FALSE }

# TO DO Why is column 4 so wide? 

stargazer(
  vacc_h1, vacc_h2, vacc_h3, vacc_h4,
  title="Linear Mixed Effects Regression Results for Vaccination Rates", 
  dep.var.labels = "Vaccination Rate (Percent)",
   order=c(1,2,3,4,5,6,7,8,10,11,9,13,12,14),
  covariate.labels = c(
    "Percent White",
    "Percent College Graduates",
    "Percent over 65",
    "Median Income",
  #   "Monthly Unemployment Rate",
    "Percent of GOP votes, 2020",
  #   "Percent Evangelical Christian",
    "Fox News Interest",
    "Covid Case Rate",
    "Week Number",
    "Community Integration",
    "Vaccination Signal",
    "Vaccination Signal x Week",
    "Vaccination Discordance",
    "Vaccination Signal x Discordance"),
    align = TRUE,
    # type = "html",
    # type = "text",
    header=FALSE,
    star.cutoffs = c(.05, .01, .001), 
    no.space = T, 
    digits = 2,
    omit.stat = c("f", 'll', 'aic', 'bic',"ser", "rsq","adj.rsq"),
    column.sep.width = "-15pt",
    # single.row = TRUE,
    font.size = "small",
    label = "vacc_results",
    omit = "Constant",
  notes= c('Models 1-4 include a random effect for Week Number by FIPS,','Models 3-4 include a random effect for the interaction of Vaccination Signal and Week by FIPS' ))
```

1. Hypothesis 1 Relatively higher local rates of infection will lead to increased vaccination uptake

The parameter phi is .99, which is a good indicator that adjacent time points
for each person are related. References: Finch, W. H., Bolin, J. E., & Kelley,
K. (2014). Multilevel modeling using R. Crc Press.

\@ref(tab:vacc_results)

2. Hypothesis 2 Having a low percent of Facebook friends living outside of the county will decreased in vaccine uptake.

super strong negative correlation of community integration, or likelihood
people from the same county would be connected, indicating that the stronger
community self-integration to more less likely to stay home, regardless of
religious and polticial affiliation.


```{r plot-vacc-h3, dependson='vacc_models', cache = TRUE, fig.cap='Predicted Values of Vaccination Rate', out.width="80%", include = FALSE, eval = FALSE }
pred4 <- ggpredict(vacc_h3, c("week_num", "vacc_signal")) %>% as_tibble()

pred4 <- pred4 %>% 
  mutate(group = case_when(group == 1 ~ "High",
                           group == 0 ~ "Average",
                           group == -1 ~ "Low"),
         group = fct_relevel(group, c("Low", "Average", "High"))) %>% 
ggplot(aes(x = x, y = predicted, color = group, fill = group)) + 
  geom_ribbon(aes(ymin = conf.low,ymax = conf.high),alpha = 0.5,color = NA) + 
    geom_line() + 
  theme_minimal() + 
  labs(subtitle='Interaction of Week Number by Vaccination Signal',
       x = "Week Number", 
       y = "Percent Fully Vaccinated, scaled)",
       fill = "Vaccination Signal", 
       color = "Vaccination Signal") +
  scale_fill_manual(values=my_palette[1:3]) +
  scale_color_manual(values=my_palette[1:3]) +
  theme(plot.title.position = "plot")

ggsave(filename = here('figs/plot-vacc-h3.png'), pred4)

knitr::include_graphics(here('figs/plot-vacc-h3.png'))
```
3. Hypothesis 3 increase vaccine uptake by alters will have a positive effect on vaccine uptake for the ego-county

see a lot vaccinated, get vaccinated. see few vaccinated, don't vaccinate.
See Figure \@ref(fig:plot-vacc-h3).

```{r plot-vacc-h4, dependson='vacc_models', cache = TRUE, fig.cap='Predicted Values of Vaccination Rate', out.width="80%", include = FALSE, eval = FALSE }
pred5 <- ggpredict(vacc_h4, c("vacc_signal", "vacc_assor")) %>% as_tibble()
pred5<-pred5 %>% 
  mutate(group = case_when(group == 1 ~ "Discordance",
                           group == 0 ~ "Average",
                           group == -1 ~ "Concordance"),
         group = fct_relevel(as.factor(group), c("Discordance", "Average", "Concordance"))) %>% 
ggplot(aes(x = x, y = predicted, color = group, fill = group)) + 
  geom_ribbon(aes(ymin = conf.low,ymax = conf.high),alpha = 0.5,color = NA) + 
    geom_line() + 

 theme_minimal() + 
  labs(subtitle='Interaction of Vaccination Signal by Vaccination Discordance',
                                   x = "Vaccination Signal",
                                   y = "Vaccination Rate (in Percent)",
                                   fill = "Vaccination\nDiscordance",
                                   color = "Vaccination\nDiscordance") +
  scale_fill_manual(values=my_palette[1:3]) +
  scale_color_manual(values=my_palette[1:3]) +
  theme(plot.title.position = "plot")

ggsave(filename = here('figs/plot-vacc-h4.png'), pred5)

knitr::include_graphics(here('figs/plot-vacc-h4.png'))
```

4. Hypothesis 4 the effect of signal direction vaccine uptake will be moderated by diversity in signals (Discordance)

see consistent high signals, most likely to get vaccinated, see inconsistent signals but still high, less likely but still decently likely to raise vaccination rates. 
See Figure \@ref(fig:plot-vacc-h4).


# Conclusion
There are a few clear limitations to this study. This is sensitive to
aggregation error and sampling error from who the mobility and social
connectedness data is coming from. The aggregation errors are potentially linked
to the assumption that the average mobility behavior of a county is a good
representation of the diversity in movement behaviors within that county.
However, aggregating the network data provides a unique network perspective that
hasn't, to my knowledge, been explored. Sociological research has long debated
about the agency of individuals and the social and institutional structure in
which individuals are immersed. In this study, I aggregate beyond the individual
case to explore overall patterns of movement which summarizes individual agency
of movement together.

Another limitation of this study is possible sampling error. This project draws
on two big-data sources [@facebook20; @googlellc00]. While Facebook and Google
do extract data from a large portion of the population, I must be mindful of the
sampling issues involved in both data sets. The Facebook data is potentially
biased by both a skew of who allows location permissions but also who has a
Facebook account and has added their friends. While I have not found any
research comparing the demographics of Facebook users to actual population, it
is easy to theorize how it may over or underrepresent different subsets of the
population in different areas [@salganikBitBitSocial2017 Section 2.3.6]. The friendship
indicator should also be read critically, because some individuals add everyone
they know as a friend, others add only close personal friends, and another
subset of the population adds many people who they do not know offline
[@courtoisSocialNetworkProfiles2012]. To my knowledge, there has been little research testing
whether these friendships represent offline connections [@golder2007rhythms;
@dunbar2016online]. In my case, however, the question of an online connection
versus and offline connection is unimportant because the movement contagion
could spread through online communication, offline communication, or simply
shared news stories and informal knowledge networks [@kittsRethinkingSocialNetworks2020].

The Google data must also be read critically because it is based on the
geo-behavioral data collected through Google Maps from users who have turned on
the Location History setting, which is off by default. This means our sample is
skewed to people in the United States a) with a mobile phone, b) with a Google
account, and c) with knowledge of how to synchronize their location history.
These requirements likely mean that there mobility data is skewed to a younger,
more affluent audience. Google has not made it clear whether their demographic
biases in their location history data are weighted in some way to rebalance the
data set so that it is representative
[@wangForecastingElectionsNonrepresentative2015; @salganikBitBitSocial2017,
Section 2.3.6]. It is therefore possible that the sampling bias may confound my
results if the age distribution through a population is associated with mobility
during COVID-19. Furthermore, Google has defined time spent in residential areas
without much context or explanation for how they classify a residential area. In
counties with a lot of vertical mobility (i.e. skyscrapers) where a residential
area may overlap with a shopping mall, there is a much larger margin of error.

\newpage
# References {-}

<div id="refs"></div>

