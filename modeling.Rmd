---
title: "Article 3: New Social Norms under Uncertain Times: A dynamic study of Stay-At-Home and Vaccination Rates During the Covid-19 Pandemic"
author: "Kelsey Gonzalez"
date: "`r format(Sys.time(), '%d %B, %Y')`"
editor_options:
  chunk_output_type: console
output:
  bookdown::pdf_document2: 
    latex_engine: xelatex
    number_sections: true
  bookdown::word_document2: 
    toc: true
    reference_docx: StylesTemplate.docx
header-includes:
   - \usepackage{siunitx}
   - \usepackage{setspace}
   - \usepackage{dcolumn}
   - \usepackage{longtable}
   - \usepackage{caption}
   - \usepackage{booktabs}
   - \usepackage{placeins}
   - \doublespacing
csl: american-sociological-association.csl
bibliography: "My Library.bib"
indent: true
---

```{r setup}
#| include=FALSE

knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE,
                      warning = FALSE,
                      cache = TRUE,
                      fig.width = 6,
                      fig.asp = 0.8,
                      out.width = "80%",
                      fig.align="center"
                      # dev.args = list(png = list(type = "cairo"))
                      )


# knitr::opts_knit$get("rmarkdown.pandoc.to")

pacman::p_load(tidyverse, here, nlme, 
               sjPlot, ggeffects, patchwork, ggridges,
               glue, modelsummary, showtext, thematic, broom.mixed,
               kableExtra, scales, tikzDevice)

count_to_state <- read_csv("https://raw.githubusercontent.com/kjhealy/fips-codes/master/county_fips_master.csv") %>% 
  mutate(FIPS = str_pad(fips, 5, pad = "0")) %>% 
  select(FIPS, state_abbr)
```

```{r plot_options}

my_palette = c('#56b4e9','#999999','#E69F00','#009E73','#CC79A7','#0072B2','#D55E00','#E69F00')
my_palette  <- c(MetBrewer::met.brewer(name = 'Cross', type = 'discrete'), '#555F61')

## Automatically use showtext to render text
font_add_google("Lora", "lora")
showtext_auto()

theme_diss <- function(base_size = 14) {
  theme_minimal(base_size = base_size) %+replace%
    theme(
      # Figure assembly
      plot.title = element_text(family="lora",
                                size = rel(1), 
                                margin = margin(0,0,5,0), 
                                hjust = 0),
      plot.title.position = "plot",
      plot.subtitle = element_text(family="lora",
                                   size = rel(0.85)),
      plot.caption = element_text(family="lora",
                                  size = rel(0.70),
                                  hjust = 1),
      # Graphical Zones
      panel.grid.minor = element_blank(),
      panel.border = element_blank(),
      # Axes
      axis.title = element_text(family="lora", 
                                size = rel(0.85)),
      axis.text = element_text(family="lora", 
                               size = rel(0.70)),
      axis.line = element_line(color = "black", 
                               arrow = arrow(length = unit(0.3, "lines"), 
                                             type = "closed")),
      # Legend
      legend.title = element_text(family="lora",
                                  size = rel(0.85)),
      legend.text = element_text(family="lora", 
                                 size = rel(0.70)),
      legend.key = element_rect(fill = "transparent", 
                                colour = NA),
      legend.key.size = unit(1.5, "lines"),
      legend.background = element_rect(fill = "transparent", 
                                       colour = NA),
      # Facetting 
      strip.background = element_rect(fill = "#17252D",
                                      color = "#17252D"),
      strip.text = element_text(family="lora",
                                size = rel(0.85), 
                                color = "white", 
                                margin = margin(5,0,5,0))
    )
}

theme_set(theme_diss()) 

```

```{r load_google}
# source("data-cleaning.R")
google_raw <- read_csv(here("data", "google_movement_main.csv"), show_col_types = FALSE)  %>% 
  filter(!(FIPS %in% c('02020', '02090', '02122', '02170'))) %>% 
  drop_na() %>%
  select(FIPS, date, SAH, movement_assor, movement_signal, 
         case_rate, p_white, p_college, income_med, perc_65_over, unemployed_rate, 
         trump_votes_2016, evangelical_county, fox_news, 
         social_dist_trend, covid_conspiracy
          # p_black, p_hispanic, 
         ) %>% 
  mutate(week_num = as.numeric((date - lubridate::ymd("2020-03-02")) / 7))
# map(google_raw, ~sum(is.na(.x)))
```

```{r load_vacc}
# source("data-cleaning.R")
vacc_raw <- read_csv(here("data", "vacc_main.csv"), show_col_types = FALSE)  %>% 
  select(FIPS, date, vacc_rate, vacc_signal, vacc_assor,
         case_rate, p_white, p_college, 
         perc_65_over, unemployed_rate, income_med, population,
         trump_votes_2020, evangelical_county, 
         fox_news, covid_19_vaccine, covid_conspiracy) %>% 
  drop_na() %>% 
    mutate(week_num = as.numeric((date - lubridate::ymd("2020-12-28")) / 7))
# map(vacc_raw, ~sum(is.na(.x)))
```


# Abstract

This article researches the formation of social norms governing health behaviors
in cases of extreme uncertainty using the cases of both a) population mobility
during early 2020 and b) vaccination rates during early 2021, both as responses
to public health recommendations to mitigate the Covid-19 pandemic. Using
theories of complex contagion, associative diffusion and the integrated
theoretical framework of norms, I test how these health behaviors are outcomes
of contagion and discordance of signals, and other
factors affecting associations like religious and political conservatism, and
attention to television media sources, and online norms as measured by
information-search behaviors. The data for this article derives from a unique
longitudinal data set that I compiled from Google, the CDC, Facebook and other
sources. To model mobility and vaccination rates, I linear mixed effects models
with random effects as a longitudinal model of contagion.


Keywords: Social Networks, Social Norms, Health Behavior


\newpage

# Background
After spreading around the world in a matter of months, the coronavirus
(COVID-19) became a leading cause of death in the United States. Although the
Centers for Disease Control and Prevention(CDC)
[-@centersfordiseasecontrolandprevention20] proposed several potential
mitigation strategies, the method of mitigation that received the most national
attention is the call to stay-at-home and social distance for non-essential
workers. CDC officials and frontline health care professionals advise that the
best way to prevent exposure to the virus is to stay at home and avoid close
contact with people.

<!-- TODO -->
to cite:

- [@wimmerDomainsDiffusionHow2021]
- vaccine misinformation [@mottaRepublicansNotDemocrats2021; @mottaIdentifyingPrevalenceCorrelates2021]

- Association Between What People Learned About COVID-19 Using Web Searches and Their Behavior Toward Public Health Guidelines: Empirical Infodemiology Study [@akpanAssociationWhatPeople2021]

- Politicization of Science in the Public Sphere: A Study of Public Trust in the United States, 1974 to 2010 [@gauchatPoliticizationSciencePublic2012]

- cite @gibbons_etal21 ; social capital can encourage and discourage distancing

A second strategy pushed by the CDC, once available, was to receive vaccination
to prevent the effects of the Covid-19 virus if infected. Vaccinations like
Pfizer-BioNTech (Comirnaty, tozinameran, BNT162b2), and  Janssen/Johnson &
Johnson, Moderna (mRNA-1273) started receiving approved for emergency use
authorization by the United States Food and Drug Administration (FDA) in
December 2020.

Although these public health interventions were pushed by policy makers
throughout 2020 and 2021, policy makers often struggle to promote public
adoption of policies that rely on the publics' willingness to adjust their
current 'risky' behaviors to less-risk behaviors based on scientific facts. The
lack of adaption to newly recommended behaviors is partially due to the
variation in how individuals came to understand the threats of the disease
[@bailey_etal20], but also due to habitus: the ingrained habits, skills and dispositions
of individuals and groups [@bourdieu77]. Habitus shapes how individuals perceive
different social interactions and norms and shape how they adopt different
policies, leading to different social outcomes and a divergence of attitudes 
[@scottarthur_etal21; @williams95; @madeira_etal18].

There is little research on shelter-in-place or stay-at-home rates, especially
during pandemics or disasters. Though research on the causes of population
mobility (how much a community leaves their homes) did expand after the onset of
the Covid-19 pandemic [@bargainTrustCompliancePublic2020;
@bourassaStatelevelStayathomeOrders2020; @bourassaSocialDistancingHealth2020;
@grossmanPoliticalPartisanshipInfluences2020;
@haggerPredictingSocialDistancing2020; @hillBloodChristCompels2020;
@hillNastiestQuestionDoes2021; @hillLoveThyAged2021;
@huynhDoesCultureMatter2020], most research focused on unchanging cultural
determinants of the reduction in mobility. Instead, this paper will focus on the
dynamic nature of population mobility across population networks.

There is more research on vaccine uptake
[@schmidBarriersInfluenzaVaccination2017] because of increased hesitancy and
anti-vaccination movements over previous decades [@baumgaertnerInfluencePoliticalIdeology2018;
@hornseyDonaldTrumpVaccination2020; @johnsonOnlineCompetitionPro2020;
@whiteheadHowCultureWars2020], even using methods such as social network
analysis [@milaniVisualVaccineDebate2020]. However, using both population
mobility and vaccine uptake provide an opportunity to conduct related but unique
analyses of the establishment of social health norms. I will first cover the
research on social networks and contagion before covering proposed mechanisms of
the spread of mobility behavior and their respective hypotheses.

## Mechanisms of meso-level behavioral contagion

### The Social Contagion Model


Individuals engage with each other and their distributive ties to create
community contexts where norms, beliefs, and values circulate. These clusters of
interaction are called social networks, and if “each person continues to
interact primarily with others nearby in space, the forces of conformity will be
strongest locally, leading to the emergence of clusters of people sharing
similar behavior” [@kittsAnalyticFrameworkSocial2018]. This community
interaction ultimately leads to converged communities of belief structures with
variations in divergence from the norm [@okadaStructureCulturalRejection2017;
@lataneExperimentalEvidenceDynamic1996;
@cullumCulturalEvolutionInterpersonal2007].

"Culture" diffuses through communities and social networks. Information and
opinions spread [@klarEffectNetworkStructure2017; @bondpolmob;
@fowler2010cooperative], behaviors are adopted
[@christakis2008collective;@rosenquist2010spread;
@aralExerciseContagionGlobal2017; @centolaSpreadBehaviorOnline2010;
@centolaExperimentalStudyHomophily2011] , and there are patterns of health
contagion [@christakisSpreadObesityLarge2007; @cacioppo2009alone]. However,
“different things spread in different ways and to different extents”
[@christakisSocialContagionTheory2013, p 563] and when modeling diffusion and
contagion, we must be very specific about our scope conditions as they are
relevant to our theory and not to cross theories to infer connections where they
may not exist [@kittsRethinkingSocialNetworks2020].

Most of the diffusion literature does not focus on establishment of new norms
but the adoption of culture and specific deviant behaviors (see
@centolaSpontaneousEmergenceConventions2015 for an exception). DellaPosta and
colleagues (-@dellapostaWhyLiberalsDrink2015) outline how the spread of culture
and behavior is tied to network autocorrelation, or “the tendency for people to
resemble their network neighbors”. They show that the distance between to agents
in sociocultural space can determine the likelihood of the adoption of a new
behavior. Like Axelrod [-@axelrodDisseminationCultureModel1997] this outlines
how the of local convergence of close network actors becomes amplified and can
lead to global polarization between groups.

Outdated models found in early public health research claim that information
about the risks of behaviors will lead to changes in behaviors to mitigate those
said risks [e.g. @flay_etal80]. However, while this model can be valid in specific
cases, more research has shown how the risks themselves do little to motivate
behavioral change [@witte_allen00; @wolburg06]. Often, an appeal to fear is
found to be a major driver of the adoption of information campaigns and some
research has show that 'social  network  exposure  to  COVID-19  cases  shapes
individuals’  beliefs  and  behaviors concerning the coronavirus.'
[@bailey_etal20]. Because of this, it is logical that higher local incidences of
infection would inspire fear and increase adherence to public health measures
according to this older model.

(@) _Hypothesis 1_ Relatively higher local rates of infection will lead to increased time spent in residence and increase vaccination uptake



### Complex Contagion and Discordance: 
@centolaComplexContagionsWeakness2007 theorize that simple contagions are not
enough to spread behavioral change. Simple contagions are those in which only
one point of contact is needed to receive contagion, like with infectious
disease or to learn simple bits of information.
@centolaComplexContagionsWeakness2007's large contribution was the theorizing
of complex contagions, those that require "independent affirmation or
reinforcement from multiple sources" (p 703) and is not based on the number of
exposures but the number of sources of exposure. In the case of behavioral
contagion, this means that the behavior must be reinforced through witnessing
multiple alters perform this behavior before contagion can take effect.
  
  


In the case of stay-at-home rates or vaccination rates, this theoretically means
that a person exposed to many sources of the same signal (high, medium, low
rates) will be more likely to adopt the behavior based on the reinforcement from
the multiple sources of exposure. As norms are inherently social, I theorize
that we can see complex contagion happening in real time with the following
hypothesis:


(@)  _Hypothesis 2_ increased average time spent in residence (signal direction) from alters will have a positive effect on time spent in residence for the ego-county; increase vaccine uptake by alters will have a positive effect on vaccine uptake for the ego-county


To make the contagion more complex, different sources of exposure
(county-alters) adhere to CDC recommendations to stay-at-home at differing
rates. Whereas one county-alter may be greatly increasing its time in residence,
another may have made little change. When the majority of alters is in
concordance with each other, the signal to the ego is reinforced and more
impactful on the ego. When these signals are mixed with high variance from
different sources, agreement is low and makes the behavioral change less likely.
For this paper, I theorize that a new concept of 'Discordance' must be
considered as impacting complex contagion. Discordance is the variance of
signals received by an alter; high discordance prevents reinforcement while low
discordance enables complex contagion. Instead of adopting a 'majority' rules
attitude, this means that the more Discordance perceived by an ego, the less
likely the alters will have any effect on the ego. I theorize that the behavior
of a county-alter will be positively correlated with the behavior of another
county-ego if the county-ego receives highly discordant signals, as seen in figure
\@ref(fig:dag).

(@)  _Hypothesis 3_ the effect of signal direction on time spent in residence and vaccine uptake will be moderated by diversity in signals (discordance)

```{r dag}
#| fig.cap='Elaboratory Theoretical Model of Health Behavior Norms',
#| fig.width = 5

knitr::include_graphics(here('figs/dag.png'))
```

### Associative Diffusion

While much of the social contagion literature, like the theories above, focuses
on structural boundaries and homophily as causes of how diffusion occurs,
Goldberg and Stein (-@goldbergSocialContagionAssociative2018) propose a
disrupting alternative mechanism. They argue that what actually diffuses during
social contagion are the perceptions about which beliefs or behaviors are
compatible with one another, what they call “associative diffusion.” This
argument that culture does not spread like a virus but instead is dependent on
how belief structures are connected to each other is important to test because
norms around health behaviors became politicized issues during the Covid-19
pandemic. This means that the stay-at-home or vaccination behavior themselves
were not contagious, but the cognitive association of precisely what social
distancing or vaccination uptake _meant_ were spreading between populations of
individuals. Moreover, as @houghton20 outlines, diffusants - the things that are
diffusing through a population, are not independent of each other. When we take
into account the interdependence between different beliefs that are diffusing,
such as Covid-19 is a hoax, social distancing saves lives, the Covid-19 includes
a microchip to control your thoughts, and lockdown is against the rights
guaranteed in the US constitution, we can imagine how these various diffusants
become associated together into structures of belief through schemas of
perception [@houghton20]. While this cognitive theory of cultural variation is
difficult to test, the theory it supplies provides a solid framework for how
behavioral norms formed during the pandemic.
 
```{r norm-framework}
#| fig.cap='Preliminary model of norm formation'

knitr::include_graphics(here('figs/model.png'))
```

The figure above illustrates how I interpret associative diffusion will impact
population movement and vaccination rates in times of unsettled norms. An
individual enters this framework when they realize they don’t have a normative
set of responses in their cultural toolkit to respond to an unfamiliar situation
they are presented with. Individuals look to norms to regulate behavior, avoid
deviance, and to maintain order [@horneNormsIntegratedFramework2020;
@shepherdStructurePerceptionHow2017]; when they don’t have a normative behavior
to follow (or rebel against), individuals look to the other sources in their
“community” to mimic behavior, such as high-status individuals, institutions,
and members of their social network. I theorize that individuals look towards
their physical community, to their social network, popular media (which may
include government and science recommendations), established norms that they may
find online through search, and to the real threat of infection (what would
happen if I do nothing about this norm). Following both the Integrated
Theoretical Framework of Norms [@horneNormsIntegratedFramework2020] and
associative diffusion [@dellapostaWhyLiberalsDrink2015;
@goldbergSocialContagionAssociative2018], I theorize that the viewing and
interpretation of what is viewed by the ego of their “community” is filtered
through their cognitive biases and behavioral predispositions to determine their
formation of new behavioral norms.

There is some evidence I can draw upon to support the associative diffusion
fraemwork. For instance, there is a central conflict between religious and
scientific ideologies which I theorize leads more religious counties to reject
the stay-at-home order and vaccines [@evansReligionScienceEpistemological2008] because the associative
diffusion places public health recommendations against realigious ideologies.
Furthermore, as COVID-19 has become a politically polarizing issue, conservative
ideology and a general mistrust of “big government” [@frank2007s] are likely to
lead to resistance to the government and scientific guidance.




# Objectives and Significance of the Study

<!-- add to contribution - and integrate better into prose - use this to outline the goals and contributions of ht epaper before outlining how we will tackle these goals   
new concept of discordance, 
measurement of complex contagion, 
meso-level networks -->

This paper is an important contribution to a few different fields. It
contributes to the literature on social influence and contagion, as social
connectedness of counties will impact regional population mobility. Moreover,
using a aggregated community-level analysis presents a unique test of the
contagion literature. Finally, looking at the diffusion of high-risk health
behaviors will be an important contribution to public health and social
epedimiology.

Unlike many observations of social networks that mediate between questions of
influence and self-selection [@lewisSocialSelectionPeer2012], this project is
unique because self-selection is a precondition to the natural experiment of the
virus. I will control for various demographic differences in county, allowing
for an isolation of behavioral change during the study period.


# Data and Methods
This article draws on two unique longitudinal datasets that I
compiled for this analysis from sources like Facebook, Google, CDC, etc.
<!-- TODO Finish this section -->

## Stay at Home Rates
```{r google-desc-table}
#| results = "asis"

counties <- google_raw %>% count(FIPS) %>% pull(FIPS)
google_dates <- google_raw %>% count(date) %>% pull(date)

datasummary(formula = (`Percent White` = p_white)  +
              (`Percent College Graduates` = p_college) +
              (`Percent over 65` = perc_65_over) +
              (`Median Income` = income_med) +
              (`Monthly Unemployment Rate` = unemployed_rate) +
              (`Percent of GOP votes, 2016` = trump_votes_2016) +
              (`Percent Evangelical Christian` = evangelical_county) +
              (`'Fox News' Trend` = fox_news) +
              (`'Social Distancing' Trend` = social_dist_trend) +
              (`'Covid Conspiracy' Trend` = covid_conspiracy) +
              (`Covid Case Rate` = case_rate) +
              (`Week Number` = week_num) +
              (`Movement Signal` = movement_signal) +
              (`Movement Discordance` = movement_assor)  ~ 
              min + max + mean + sd, 
            data = google_raw,
            title = 'Descriptive Statistics for Stay-at-Home Models (county-level)',
            notes =c(glue("Notes: {format(length(counties), nsmall=1, big.mark=',')} counties, {format( min(google_dates), '%B %d')} through {format(max(google_dates), '%B %d')}, 2020."),
                     "Raw values presented in table. Values in models are normalized."))%>%
  kable_styling(latex_options = c( "hold_position", "condensed"))

```
```{r plot-google}
#| cache = TRUE,
#| fig.cap = "Stay at Home Rates over Time",
#| dependson='plot_options'

vroom::vroom(here("data","covid-mobility", "2020_US_Region_Mobility_Report.csv"), show_col_types = FALSE)  %>%
  drop_na(census_fips_code) %>% 
  select(date, FIPS = census_fips_code, SAH = residential_percent_change_from_baseline) %>% 
  filter(!is.na(FIPS)) %>%
  complete(date, FIPS)  %>% 
  group_by(FIPS) %>%
  mutate(sumNA = sum(ifelse(is.na(SAH), 1, 0))) %>% 
  filter(sumNA < 200) %>% 
  fill(SAH, .direction = 'downup') %>%
  filter(!is.na(SAH)) %>% 
  mutate(SAH = zoo::rollmean(SAH, k = 7, fill = "extend"))  %>% 
  ggplot(aes(x=date, y=SAH)) +
  geom_line(aes(group=FIPS), color = tail(my_palette, n=1), alpha = .6) + 
  geom_smooth(color = my_palette[7]) +
  labs(caption = 'Data from the Google Community Mobility Report',
       x = '2020 Date', 
       y = 'Stay-at-Home Rate, Percent change from baseline') 

```


My first dependent variable aims to operationalize behavioral norms as
stay-at-home rates with data from Google [@google2020]. While the Google
COVID-19 Community Mobility Reports include multiple measures of mobility based
on location and activity information, the change in time spent in Residences
most closely aligns to an operationalization of an obedience to CDC and governor
orders, a new and emerging norm in 2020. The change in time spent in Residences
variable represents percent change of time spent from Google Location History
within geographic areas that Google has designated as a residential area. These
data are aggregated to the county-level based on anonymized sets of data from
users who have turned on the Location History setting, which is off by default.
Google calculates the relative change in mobility in comparison to the median
value of movement in the area for the same the corresponding day of the week,
during the 5-week period Jan 3–Feb 6, 2020. As Google did not provide data on
certain US counties if they did not have sufficient statistically significant
levels of data, my final county sample is _n_ = `r google_raw %>% count(FIPS) %>% nrow()`
(compared to the total population of 3,107 US counties). Particular areas that
are excluded in this analysis include all counties in Alaska and DC, and over
half of the counties in North Dakota, South Dakota, and a few other counties.
Full list of excluded counties available upon request. These data are
longitudinal measures calculated by creating a moving average of stay-at-home
rates for each county (rolling window width = 7 days) and then sampling every
Monday in the sample for 44 measures from March 02, 2020 through December 28,
2020.

```{r}
#| include = FALSE,
#| eval = FALSE

included = google_raw %>% count(FIPS) %>% pull(FIPS)
count_to_state %>% 
  mutate(in_data = ifelse(FIPS %in% included, TRUE, FALSE)) %>% 
  count(state_abbr, in_data) %>%
  pivot_wider(id_cols = state_abbr,
              names_from = in_data,
              values_from = n,
              values_fill = 0) %>%
  mutate(percent_missing = `FALSE` / (`FALSE` + `TRUE`)) %>% 
  arrange(-percent_missing)
```


## COVID vaccination uptake
```{r vacc-desc-table}
#| results = "asis"


counties <- vacc_raw %>% count(FIPS) %>% pull(FIPS)
vacc_dates <- vacc_raw %>% count(date) %>% pull(date)

datasummary(formula = (`Percent White` = p_white)  +
              (`Percent College Graduates` = p_college) +
              (`Percent over 65` = perc_65_over) +
              (`Median Income` = income_med) +
              (`Monthly Unemployment Rate` = unemployed_rate) +
              (`Percent of GOP votes, 2020` = trump_votes_2020) +
              (`Percent Evangelical Christian` = evangelical_county) +
              (`'Fox News' Trend` = fox_news) +
              (`'Covid-19 vaccine' Trend` = covid_19_vaccine) +
              (`'Covid Conspiracy' Trend` = covid_conspiracy) +
              (`Covid Case Rate` = case_rate) +
              (`Week Number` = week_num) +
              (`Vaccination Signal` = vacc_signal) +
              (`Vaccination Discordance` = vacc_assor)  ~ 
              min + max + mean + sd, 
            data = vacc_raw,
            title = 'Descriptive Statistics for Vaccination Models (county-level)',
            notes = c(glue("Notes: {format(length(counties), nsmall=1, big.mark=',')} counties, {format( min(vacc_dates), '%B %d')} through {format(max(vacc_dates), '%B %d')}, 2021."),"Raw values presented in table. Values in Models are normalized.")) %>%
  kable_styling(latex_options = c("hold_position", "condensed"))
```
```{r plot-vacc}
#| cache = TRUE ,
#| fig.cap = "Vaccination Rates over Time",
#| dependson='plot_options'

vroom::vroom(here("data","vaccination-rates", "COVID-19_Vaccinations_in_the_United_States_County.csv"), show_col_types = FALSE) %>% 
  mutate(date = lubridate::mdy(Date, quiet = TRUE)) %>% 
  select(FIPS, date, vacc_rate = Series_Complete_Pop_Pct) %>% 
  left_join(count_to_state, by = "FIPS") %>% 
  filter( ! (state_abbr %in% c("HI", "TX")),
          ! (FIPS %in% c('25001', '25007', '25019')),
          ! (FIPS %in% c("06003","06027", "06043", "06049", "06051", "06063", "06091", "06105")),
          (FIPS != 'UNK')) %>% 
  complete(date, FIPS)  %>% 
  group_by(FIPS) %>%
  mutate(vacc_rate = zoo::rollmean(vacc_rate, k = 7, fill = NA)) %>% 
  ggplot(aes(x=date, y=vacc_rate)) +
  geom_line(aes(group=FIPS), color = tail(my_palette, n=1), alpha = .6) + 
  geom_smooth(color = my_palette[7]) +
  labs(caption = 'Data from the CDC',
       x = '2021 Date', 
       y = 'Vaccination Rate')

```

The second dependent variable aims to operationalize vaccination uptake through
vaccination rate information in the United States from January 2021 through
August 30 2021 [@cdcCOVID19Vaccination2021]. Data represents all vaccine partners including
jurisdictional partner clinics, retail pharmacies, long-term care facilities,
dialysis centers, Federal Emergency Management Agency and Health Resources and
Services Administration partner sites, and federal entity facilities.
Vaccination data is available for all US counties with the exception of parts of
California and Massachusetts, Hawaii, Texas. In Texas and Hawaii, no county
level information is available, and California does not report the county of
residence for vaccinations when the county of residence has a population less
than 20,000 people. Finally, Massachusetts does not provide vaccination data for
Barnstable, Dukes, and Nantucket counties because of their small populations.
Therefore, my final county sample for vaccination rates is _n_ = `r vacc_raw %>% count(FIPS) %>% nrow()` 
(compared to the total population of 3,107 US counties). A list of included FIPS
are available upon request. Vaccination rates are scaled with a rolling mean
with a rolling window width of seven days to smooth out intra-week noise. I
sample every Monday between January 2021 through August 30 2021 for 35 total
observations for each county. 

## Independent Variables

### Network Signal

Secondly, I utilize the likelihood of a friendship connection between counties
to create a county-level social network weighted by the probability of a tie.
Using this network and the two independent variables above, I examine how the
vaccination and stay-at-home rates of peer counties is contagious to the
ego-county. To do this, I first take the weighted average of each ego's network
signals using the equation \@ref(eq:networksignal) where `x` denotes the
vaccination and stay-at-home rates of each alter county and `w` represents the
likelihood of a friendship connection between the ego county and each of their
alters, lagged by one week. This 'signal' of norms gives us insight into the
coevolving contagion patterns of the new social norm being established. The
likelihood of friendship connection comes from the "Social Connectedness Index"
[@Bailey2018; @facebook20] which indexes the social links between geographies by
the likelihood of Facebook friends. It is an aggregated measure of Facebook
friendship connections between counties. It corresponds to “the (relative)
probability that two arbitrary Facebook users across two geographies are friends
with each other". The data is available at various geographic aggregation
levels, such as U.S. zip codes or entire countries. However, data is only
available at one time point because Facebook has found that although there are
individual changes in friendship connections over time, the aggregate
statistical probabilities of friendship remain stable. This measure is based on
user-provided information and real-time location-service data gathered by
Facebook. Facebook data has been shown to be highly representative of the U.S.
population and Facebook friendship links largely represent real-world
friendships [@bailey_etal18; @jones_etal13]. The data has been tested to show
how initial COVID-19 hotspots are related to subsequent virus spread to
non-hotspots, even after controlling for population density and geographic
distance [@Kuchler2020].

\begin{equation}
signal = \frac{\sum_{i=1}^nw_ix_i}{\sum^n_{i=1}w_i} (\#eq:networksignal)
\end{equation}

### Signal Discordance

The third independent variable, _Signal Discordance_, builds on the network
signal but looks specifically at the extent to which a given ego-network
receives diverse contagion signals. Based on the hypothesis that when the
majority of alters is in concordance with each other, the signal to the ego is
reinforced and more impactful on the ego, a high discordance coefficient is
indicative of diverse signals which may prevent any clear interpretation of a
norm developing, whereas a low discordance coefficient would indicate reinforced
signaling. I use the formula to calculate weighted standard deviations, (see equation
\@ref(eq:signaldiscordance)) to provide a metric of a diversity of signals. In
this formula, `x` denotes the vaccination and stay-at-home rates of each alter
county and `w` represents the likelihood of a friendship connection between the
ego county and each of their alters, lagged by one week. Furthermore, $\bar{x}^*$ 
represents the weighted mean. 

\begin{equation}
discordance = \sqrt{\frac{\sum_{i=1}^nw_i(x_i-\bar{x}^*)^2}{\sum^n_{i=1}w_i}} (\#eq:signaldiscordance)
\end{equation}

Figure \@ref(fig:assortativity-vacc) provides a visualization of both network
signal and signal discordance for April 26, 2021 for 7 selected counties
^[Figures in this paper were all created using ggplot2 and patchwork [@pedersen;
@wickham_etal; @wickham11] ]. While a county like Lake County, Ohio has low
discordance meaning the signal of vaccination rate is reinforced, Navajo County,
Arizona receives very diverse signals from their county-alters, negating any
contagion effects.
```{r discordance_extra_data_load}

sample = c("08003", '55057', '51059', '39085', 
           # '36119',
           '34021', '12071', '04017' )

sci <- readr::read_tsv(here('data', 'social-connectedness', 'county_county.tsv') ) %>% 
  mutate(scaled_sci = scaled_sci/1000000000) %>%
  filter(scaled_sci > 0.00001)

count_to_state <- read_csv("https://raw.githubusercontent.com/kjhealy/fips-codes/master/county_fips_master.csv") %>% 
  mutate(FIPS = str_pad(fips, 5, pad = "0"),
        name = paste0(county_name,", " ,state_abbr)) %>% 
  select(FIPS, name)
```
```{r assortativity-vacc}
#| dependson=c('plot_options','load_vacc','discordance_extra_data_load'),
#| cache = TRUE,
#| fig.cap = 'How Signal Mean and Signal Assortativity are Measured',
#| out.width="70%",
#| fig.asp = 1.5

plot1c_data <- vacc_raw %>% 
  dplyr::filter(date == lubridate::ymd("2021-04-26")) %>%
  left_join(count_to_state, by = "FIPS") %>% 
  mutate(name = ifelse(FIPS %in% sample, name, NA_character_),
         size= ifelse(FIPS %in% sample, 2, 1),
         alpha= ifelse(FIPS %in% sample, 1, .5)) 

plot1c <- ggplot() + 
  #background points)
  geom_point(data = filter(plot1c_data, is.na(name)), 
             aes(x = vacc_signal, y = vacc_assor), 
             size = 1,
             alpha = .25,
             color = 'grey') + 
  #highlighted points
  geom_point(data = filter(plot1c_data, !is.na(name)), 
             aes(x = vacc_signal, y = vacc_assor, color = fct_reorder(name,vacc_assor)),
             size = 4,
             alpha = 1) +
  geom_text(data = filter(plot1c_data, !is.na(name)),
            aes(x = vacc_signal, 
                y =vacc_assor, 
                label =  fct_reorder(name,vacc_assor),
                color =  fct_reorder(name,vacc_assor)), 
            size = 3,
            vjust = -1,
            hjust = -0.15) + 
  theme(legend.position = 'none') +
  scale_fill_manual(values=my_palette[1:7]) +
  scale_color_manual(values=my_palette[1:7]) +
  labs(title = 'Scatterplot of Signals and Discordance with 7 counties highlighted',
       x = 'Vaccination Signals for 04-26-2021', y = 'Signal Discordance')

plot1d_data <- tibble(FIPS = sample, date = lubridate::ymd("2021-04-26")) %>% 
  dplyr::mutate(date_lag = date - 7) %>% 
  dplyr::left_join(sci, by = c("FIPS" = "user_loc")) %>%     
  dplyr::inner_join(select(vacc_raw, date, FIPS, vacc_rate), by = c(c("fr_loc" = "FIPS"),
                                       c("date_lag" = "date"))) %>%
  left_join(count_to_state, by = "FIPS") %>% 
  left_join(select(vacc_raw, FIPS, date, vacc_signal, vacc_assor), by = c('date', 'FIPS'))

plot1d <- plot1d_data %>% 
  mutate(name = fct_reorder(name, vacc_assor)) %>% 
  filter(FIPS != fr_loc) %>% 
  ggplot() + 
  geom_density_ridges(aes(x = vacc_rate, y = name, fill = name, weight = scaled_sci,
                          height=..density..), 
                      alpha = 0.5, show.legend = FALSE, color = NA,
                      stat='density') +
  geom_segment(aes(x = (vacc_signal - vacc_assor) , 
                   xend = (vacc_signal + vacc_assor),
                   y = name, 
                   yend = name), lineend = 'butt', size = 2,
               show.legend = FALSE, alpha = 0.6, color = '#4c4c4c') +
  geom_point(aes(x = vacc_signal, y = name, color = name), 
             size = 3, show.legend = FALSE) +
  geom_point(aes(x = vacc_signal, y = name), size = 1, 
             color = '#4c4c4c', show.legend = FALSE, alpha = 0.6) +
  labs(x = 'Vaccination Signals for 04-26-2021', y = '',
       title = 'Weighted Densities of Vaccination Signals per county with weighted average\nand standard deviation highlighted',
       subtitle = 'Colored Point = Weighted average; Grey line = Weighted SD, i.e. Discordance',
       caption = 'Densities Weighted by likelihood of Facebook Friendship connection')  +
  scale_fill_manual(values=my_palette[1:7]) +
  scale_color_manual(values=my_palette[1:7]) 
  
plot1c/plot1d


rm(list = c("plot1c_data"))

```
```{r discordance-network}
#| fig.cap='Visualization of how Network Signal and Discordance are Calculated (needs to be made more professional)',
#| out.width="50%"

knitr::include_graphics(here('figs/discordance_network_ugly.PNG'))
```
$$ w = \begin{bmatrix}0.0000026\\0.0000966\\0.0000523\\0.0001120\\\end{bmatrix},  
x = \begin{bmatrix}17.4\\42.8\\24.6\\24.3\\\end{bmatrix} \longrightarrow
\begin{matrix}
\bar{x}, signal = 28.02007\\
s, discordance = 7.391
\end{matrix}
$$


### Case Rate
To estimate the concept of 'real threat of infection' in figure
\@ref(fig:norm-framework), the models use county-level Covid-19 case rates with
data from @thenewyorktimes21. It is widely acknowledged that there are biases in
this data due to inconsistencies and availability in testing as well as
different community propensity to test [@gu22; cdc20a] However, it is the best
measure we have of actual case rates. County data are scaled with a rolling mean
with a rolling window width of seven days to smooth out intra-week noise. Case
Rate is measured as number of cases per 100,000 population. Observations vary
from 0 to 1,565 between the two datasets.

### Online Norms
To operationalize the search for online norms, I again use Google search trends
over the study period across individual designated media markets areas (DMAs), a
nonoverlapping aggregation of U.S. counties to 210 media markets based on
similar population clusters. To investigate the rate of _searching_ for norms
online in both cases, I use the following search topics: 'Social Distancing'
(2020, stay-at-home case only), 'Covid-19 Vaccine' (2021 Vaccination Uptake case
only) and Covid Conspiracy (2020-2021, both cases). Search topics are a more
robust measurement than a single search term: topics are aggregations of the
rates of multiple, highly correlated search terms together into a cohesive
topic. For example, while 'Beyoncé', 'Beyonce' and 'beyonce knowles' are all
separate search terms, 'Beyoncé Knowles' encompasses all of these into a single
search topic. While the data is originally on a original scale of 0 to 100, with
100 being the maximum search popularity out of all DMAs, Google Search Trend are
now only available cross-sectionally (a single time period across a geography)
or time-series (a single geo-location across time). To remedy this and build a
longitudinal dataset of each search topic, I follow the method proposed in
@park_etal, p. 5. This method involves building a dataset of unscaled
cross-sectional values, selecting a DMA to use to establish the  rescaling ratio
(I use 'Los Angeles CA'), and then finding the time-series values for the one
DMA. To find the rescaling ratio for each week in the time-series, you divide
the time-series value for each week by the cross-sectional value for each week,
resulting in a rescaling vector to be used for all weeks in the dataset across
geographies. To rescale each longitudinal value, multiply the respective week's
rescaling ratio by the cross-sectional value. Rescaled longitudinal data was
compared against time-series data for multiple test counties and was equivalent. 

<!-- TODO you might also have a concrete example of how you are using
cross-sectional weights in Los Angeles to construct county-level time series
data. -->


### Pillars of Convervatism
Research has shown that stay-at-home rates and other pandemic health behaviors
are related to various 'pillars of conservatism' [@hillBloodChristCompels2020;
@hillNastiestQuestionDoes2021; @hillLoveThyAged2021;
@gonzalez_etal21]. Namely, research shows that politically conservative
indicators, such as  Republican political leadership, conservative Protestantism
and consumption of right-wing media are related to higher rates of movement and
lower rates of mask usage. Based on these findings, this article controls for
these factors in the following ways: to measure Republican political leadership,
I include percentage of votes for Donald Trump in the previous presidential
election; for the 2020 study, I use the 2016 results and for the 2021 study, I
use the 2020 results to infer proper time ordering. Second, to measure
conservative Protestantism with the county’s percentage of evangelical
Christians. These county-level data were collected through the 2010 U.S.
Religion Census: Religious Congregations and Membership Study
[@grammich_etal18]. Finally, right-wing media consumption is assessed using
Google Search Trends to capture “Fox News” searches over the study period across
individual designated media markets areas (DMAs), a nonoverlapping aggregation
of U.S. counties to 210 media markets based on similar population clusters [@dma_key].
DMA value represents the popularity of the search term on a scale of 0 to 100,
with 100 being the maximum search popularity out of all DMAs and all searches.
However, these rates are rescaled using a process described in [Online
Norms](#online-norms) below. I use this measure to indicate active interest in
and attention toward Fox News. Google Search Trends have been validated for use
in a range of research contexts and for use with survey data, voting data, and
ecological data [@bailPrestigeProximityPrejudice2019;
@reyesUsingInternetSearch2018; @scheitleGoogleInsightsSearch2011; 
@stephens-davidowitzCostRacialAnimus2014; @swearingenGoogleInsightsSenate2014].



### Demographics

These models also control for (1) percent of the population that is above 65
years old (those most at risk of hospitalization), (2) percent of the population
that identifies as white, (3) percent of the population that holds a college
degree, (4) median income, and (5) monthly county unemployment rate. Measures 1
through 4 are obtained from the 2018 American Community Survey: 5-Year Estimates
[@uscensusbureauAmericanCommunitySurvey2018]; unemployment rates are gathered
from the U.S. Bureau of Labor Statistics [@labor2020a].


# Analysis and Results

```{r google_models}
#| dependson='load_google',
#| cache = TRUE


google <- google_raw %>% 
  mutate(across(SAH:covid_conspiracy , ~ scale(.x, center=TRUE, scale=TRUE)))
rm(list = c("google_raw"))

google <- google %>% 
  left_join(google %>%
              group_by(FIPS) %>%
              summarize(SAH_fips_mean = mean(SAH, na.rm = TRUE)),
            by = "FIPS")

google_h1 <- lme(fixed = SAH ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                  trump_votes_2016 + evangelical_county + 
                 fox_news + social_dist_trend + covid_conspiracy +
                  SAH_fips_mean + 
                  case_rate + week_num,
             random = ~ 1 | FIPS,
             data = google,
             correlation = corAR1(),
             control = lmeControl(opt = "optim"))


# write_rds(google_h1, here("modeling_cache/google_h1.rds"))
# google_h1 <- read_rds("modeling_cache/google_h1.rds")

google_h2 <- lme(fixed = SAH ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                  trump_votes_2016 + evangelical_county + 
                 fox_news + social_dist_trend + covid_conspiracy +
                  SAH_fips_mean + 
                  case_rate +
                  movement_signal*week_num,
             random = ~ (1 + movement_signal) | FIPS,
             data = google,
             correlation = corAR1(),
             control = lmeControl(opt = "optim"))
# write_rds(google_h2, here("modeling_cache/google_h2.rds"))
# google_h2 <- read_rds("modeling_cache/google_h2.rds")


google_h3 <- lme(fixed = SAH ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                  trump_votes_2016 + evangelical_county + 
                 fox_news + social_dist_trend + covid_conspiracy +
                  SAH_fips_mean + 
                  case_rate +
                  movement_signal*week_num +
                  movement_signal*movement_assor,
             random = ~ (1 + movement_signal) | FIPS,
             data = google,
             correlation = corAR1(),
             control = lmeControl(opt = "optim"))
# write_rds(google_h3, here("modeling_cache/google_h3.rds"))
# google_h3 <- read_rds("modeling_cache/google_h3.rds")



```
```{r vacc_models}
#| dependson='load_vacc',
#| cache = TRUE


# vacc %>% 
#   select(where(is.numeric)) %>% 
#   cor() %>%  
#   round(2) %>%
#   as.data.frame() %>% 
#   tibble::rownames_to_column("row") %>%
#   pivot_longer(cols = -row) %>% 
#   ggplot(aes(x = row, y = name, fill = value)) + 
#   geom_tile() + geom_text(aes(label = value)) + 
#   theme(axis.text.x = element_text(angle = 45))

vacc <- vacc_raw %>% 
  mutate(across(vacc_rate:covid_conspiracy, ~(scale(.x, scale = TRUE, center = TRUE)))) 
rm(list = c("vacc_raw"))

vacc <- vacc %>% 
  left_join(vacc %>%
              group_by(FIPS) %>%
              summarize(vacc_fips_mean = mean(vacc_rate, na.rm = TRUE)),
            by = "FIPS")

vacc_h1 <- lme(fixed = vacc_rate ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                trump_votes_2020 + evangelical_county +
                fox_news + covid_19_vaccine  + covid_conspiracy + vacc_fips_mean + 
                case_rate + week_num,
             random = ~ 1 | FIPS,
             data = vacc,
             correlation = corAR1(),
             control = lmeControl(opt = "optim"))
write_rds(vacc_h1, here("modeling_cache/vacc_h1.rds"))
# vacc_h1 <- read_rds("modeling_cache/vacc_h1.rds")


vacc_h2 <- lme(fixed = vacc_rate ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                trump_votes_2020 + evangelical_county +
                fox_news + covid_19_vaccine  + covid_conspiracy + vacc_fips_mean + 
                case_rate + vacc_signal*week_num,
             random = ~ (1 + vacc_signal) | FIPS,
             data = vacc,
             correlation = corAR1(),
             control = lmeControl(opt = "optim"))
# write_rds(vacc_h2, here("modeling_cache/vacc_h2.rds"))
# vacc_h2 <- read_rds("modeling_cache/vacc_h2.rds")


vacc_h3 <- lme(fixed = vacc_rate ~ p_white + p_college + perc_65_over + 
                  income_med + unemployed_rate +
                trump_votes_2020 + evangelical_county +
                fox_news + covid_19_vaccine  + covid_conspiracy + vacc_fips_mean + 
                case_rate + vacc_signal*week_num + vacc_signal*vacc_assor,
             random = ~ (1 + vacc_signal) | FIPS,
             data = vacc,
             correlation = corAR1(),
             control = lmeControl(opt = "optim"))
# vacc_h3 <- read_rds("modeling_cache/vacc_h3.rds")



```

My analytic strategy proceeds in four steps. In Tables
\@ref(tab:google-desc-table) (Stay-at-Home) and \@ref(tab:vacc-desc-table)
(Vaccination Uptake), I present descriptive statistics for all study variables,
including variable ranges, means, and standard deviations across the two cases.
Then, in Tables \@ref(tab:google-tab) (Stay-at-Home) and \@ref(tab:vacc-tab)
(Vaccination Uptake), I fit a series of three linear mixed effects regression
models using the nlme package in R [@pinheiro_etal21; @pinheiro_bates00] for our
two cases, Stay-at-Home rates and Vaccination rates. Linear mixed effects models
are a form of hierarchical linear models that contain both random and fixed
effects. These models treat the dependent variables as continuous. Models 1
through 3 address hypotheses 1 through 3 respectively. The following strategies
I will outline are identical for both case studies. Each model utilizes
normalized independent variables, i.e. variables that have been centered and
scaled to have a mean of 0 and standard deviation 1. The first model is a
baseline linear mixed effects model that employs all basic controls to predict
the dependent variable, allowing both time-varying and county-level variables to
predict the outcome. All variables have fixed effects, meaning that the
county-level exogenous effects are controlled for when estimating the
coefficient. In addition, models are specified with a random intercept per
county. The lme models are set with a autoregressive correlation structure
(`correlation = corAR1()`) to control for temporally autocorrelated error
structures; models are also optimized using Nelder–Mead, quasi-Newton and
conjugate-gradient algorithms for box-constrained optimization and simulated
annealing (`control = lmeControl(opt = "optim")`). This first model will address
Hypothesis 1. To test hypothesis 2, I estimate model 2 which builds on model 1
by first introducing vaccination signal. Because the signal varies by week, I
estimate this model with an interaction between week and signal. And finally,
because signal may have divergent effects across counties, I set a random effect
for signal nested by county. A visual representation of this interaction can be
seen in figures \@ref(fig:plot-google-h2) and \@ref(fig:plot-vacc-h2). Model 3
further elaborates the previous model by introducing both a fixed effect for
signal discordance and an interaction term between signal and discordance.
Figures \@ref(fig:plot-google-h3) and \@ref(fig:plot-vacc-h3) depict just how
signal and discordance interact across these two cases.



## Stay-at-Home Rate results
```{r google-tab}
#| dependson='google_models',
#| cache = TRUE,
#| results = 'asis' 

google_labels = c(
    'p_white'="Percent White",
    'p_college' = "Percent College Graduates",
    'perc_65_over' = "Percent over 65",
    'income_med' = "Median Income",
    'unemployed_rate' = "Monthly Unemployment Rate",
    'trump_votes_2016' = "Percent of GOP votes, 2016",
    'evangelical_county' = "Percent Evangelical Christian",
    'fox_news' = "'Fox News' Trend",
    'social_dist_trend' = "'Social Distancing' Trend",
    'covid_conspiracy' = "'Covid Conspiracy' Trend",
    'case_rate' = "Covid Case Rate",
    'week_num' = "Week Number",
    'SAH_fips_mean' = 'Stay at Home Rate, county mean',
    'movement_signal' = "Signal",
    'movement_signal:week_num' = "Signal x Week",
    'movement_assor' = "Signal Discordance",
    'movement_signal:movement_assor' = "Signal x Signal Discordance")

modelsummary(list(google_h1, google_h2, google_h3),
             title = "Linear Mixed Effects Regression Results for Stay-At-Home Rates",
             notes= c('* p < .05. ** p < .01. *** p < .001 (two-tailed test).',
                      'Model 1 includes a random intercept for FIPS,',
                      'Models 2-3 include a random effect for Movement Signal by FIPS',
                      glue('N = {scales::label_comma()(nobs(google_h1))}, N of random Effects = {google_h3$dims$ngrps[["FIPS"]]}')),
             estimate = "{estimate}{stars}",
             coef_map = google_labels,
             gof_omit = 'AIC|BIC|ICC|RMSE'
             ) %>%
  kable_styling(latex_options = c("hold_position", 'condensed'),
                font_size = 8)


```

In Table \@ref(tab:google-tab) and Figures \@ref(fig:plot-google-h2) -
\@ref(fig:plot-google-h3), I present the elaboratory county-level models that
predict stay-at-home rates, or, time spent in residence. Model 1 addresses
hypothesis 1, that relatively higher local rates of infection will lead to
increased time spent in residence. This model's phi paramter is 0.933, which is
a good indicator that adjacent time points for each county are related and the
model is specified correctly [@finch_etal14]. In this first model, many controls
have an impact on the outcome. For instance, when controlling for everything
else, the percent of GOP votes in 2016, the percentage of residents who identify
racially as White, and higher rates of unemployment increased the stay-at-home
rate increased the stay-at-home rate while Searches for norms online seems to
have an effect on the outcome: searches for 'Fox News' are associated with
decreased stay-at-home rates, while searching for both 'Social Distancing' and
'Covid Conspiracy' tend to increase time spent in residence. Interestingly, the
perceived threat of the virus, measured through Covid-19 case rates, were not
significantly related to stay-at-home rates in model 1. In other words, for
every 1 standard deviation increase in Covid-19 case rates, stay-at-home rates
actually decreased by
`r broom.mixed::tidy(google_h1) %>% filter(term == 'case_rate') %>% pull(estimate) %>% round(4)` (_p_ = `r broom.mixed::tidy(google_h1) %>% filter(term == 'case_rate') %>% pull(p.value) %>% round(3)`), 
a very small and insignificant effect. In this case, I fail to reject the null
hypothesis that relatively higher local rates of infection will lead to
increased time spent in residence.

Table \@ref(tab:google-tab) Model 2 investigates Hypothesis 2, that increased
average time spent in residence (signal direction) from alters will have a
positive effect on stay-at-home rates for the ego-county. This model builds on
model 1 by adding in the variable for Movement Signal (see [Network
Signal](#network-signal) for specifications). For every one standard deviation
increase in the average time spent in residence of the county alters, an ego tends to also increase its' own stay-at-home
rate by `r broom.mixed::tidy(google_h2) %>% filter(term == 'movement_signal') %>% pull(estimate) %>% round(3)`
(_p_ <  0.001). I am therefore able to reject my null hypothesis for hypothesis
2, that an increased average time spent in residence (signal direction) from
alters will have a positive effect on time spent in residence for the
ego-county.

```{r plot-google-h2}
#| dependson=c('plot_options','google_models'),
#| cache = TRUE,
#| fig.cap='Predicted Values of Stay at Home Rate by Movement Signal'

pred2 <- ggpredict(google_h2, c("week_num", "movement_signal")) %>% as_tibble()

pred2 %>% 
  mutate(group = case_when(group == 1 ~ "High",
                           group == 0 ~ "Average",
                           group == -1 ~ "Low"),
         group = fct_relevel(group, c("Low", "Average", "High"))) %>% 
  ggplot(aes(x = x, y = predicted, color = group, fill = group)) + 
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high),alpha = 0.5,color = NA) + 
  geom_line() + 
  labs(title='Interaction of Week Number by Movement Signal',
       x = "Week Number", 
       y = "Stay at Home Rate (Change from Baseline)",
       fill = "Movement Signal", 
       color = "Movement Signal") +
  scale_fill_manual(values=my_palette[c(2,5,8)]) +
  scale_color_manual(values=my_palette[c(2,5,8)])


```

However, this coefficient is inadequate alone because the effect varies over
time; the interaction between week and movement signal is negative, meaning that
week partially moderates the effect of the signal. Figure
\@ref(fig:plot-google-h2) illustrates this interaction. In the early days of the
Covid-19 pandemic, seeing a high rate of time spent in residence by alters led
to a high rate of staying-at-home for county egos. However, as the pandemic
progressed, these signals switched. In other words, towards the end of 2020,
other factors may have come into play and if a county saw its' alters social
distancing and spending time in residence, ego counties spent less time at home.
Theoretically, this may be because individuals saw their adjacent communities
with strong public health norms and felt safe and justified their own deviance.
However, if an ego county received signals that
others were failing to social distance, they were more likely to stay-at-home.
In this case, the threat of the virus may have been more evident for
individuals. 
```{r plot-google-h3}
#| dependson=c('plot_options','google_models'),
#| cache = TRUE,
#| fig.cap='Predicted Values of Stay at Home Rate Moderated'

pred3 <- ggpredict(google_h3, c("movement_signal", "movement_assor")) %>% as_tibble()

pred3 %>% 
  mutate(group = case_when(group == 1 ~ "Discordance",
                           group == 0 ~ "Average",
                           group == -1 ~ "Concordance"),
         group = fct_relevel(group, c("Discordance", "Average", "Concordance"))) %>% 
  ggplot(aes(x = x, y = predicted, color = group, fill = group)) + 
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.5, color = NA) + 
  geom_line() + 
  labs(title='Interaction of Movement Signal by Movement Signal Discordance',
       x = "Movement Signal",
       y = "Stay at Home Rate (Change from Baseline)",
       fill = "Movement Signal\nDiscordance",
       color = "Movement Signal\nDiscordance") +
  scale_fill_manual(values=my_palette[c(2,5,8)]) +
  scale_color_manual(values=my_palette[c(2,5,8)]) 

```
Model 3 then adds the concept of Signal Discordance to investigate Hypothesis 3,
that the effect of signal direction on stay-at-home rates will be moderated by a
diversity in signals (_discordance_). Many of the controls remain consistent
throughout the models, with the exception of 'Social Distancing' Trend whose
effect has been completed mediated by the inclusion of signal discordance.
Importantly, signal discordance has a negative effect on stay-at-home rates,
where every one standard deviation increase in discordance lowers rates by
`r broom.mixed::tidy(google_h3) %>% filter(term == 'movement_assor') %>% pull(estimate) %>% round(3)` 
(_p_ <  0.001). The interaction between signal and signal discordance have a
coefficient of a similar magnitude, with every one standard deviation increase
in discordance and signal resulting in
`r broom.mixed::tidy(google_h3) %>% filter(term == 'movement_signal:movement_assor') %>% pull(estimate) %>% round(3)` 
lower rates of time spent in residence, indicating moderation. Figure
\@ref(fig:plot-google-h3) illustrates the moderating effect that signal
discordance has on signal. Under high discordance, the social influence effect
is almost completely moderated because there is no clear story or norm forming.
However, under low discordance, the signal is condensed, allowing for social
influence to have an effect. Explicitly, if a county is receiving a wide array
of low and high signals, their stay at home rates won't be affected. When a
signal is concentrated or in agreement, the theoretical effect of movement
signaling on the ego are the strongest. With this, I am able to reject the null
hypothesis of no relationship for hypothesis 4 and find that the effect of
signal direction on time spent in residence and vaccine uptake will be moderated
by diversity in signals.

## Vaccination Rate results
```{r vacc-tab}
#| dependson='vacc_models',
#| cache = TRUE,
#| results = 'asis' 

vacc_labels = c(
    'p_white'="Percent White",
    'p_college' = "Percent College Graduates",
    'perc_65_over' = "Percent over 65",
    'income_med' = "Median Income",
    'unemployed_rate' = "Monthly Unemployment Rate",
    'trump_votes_2020' = "Percent of GOP votes, 2020",
    'evangelical_county' = "Percent Evangelical Christian",
    'fox_news' = "'Fox News' Trend",
    'covid_19_vaccine' = "'Vaccine' Trend",
    'covid_conspiracy' = "'Covid Conspiracy' Trend",
    'case_rate' = "Covid Case Rate",
    'week_num' = "Week Number",
    'vacc_fips_mean' = 'Vaccination Rate, county mean',
    'vacc_signal' = "Vaccination Signal",
    'vacc_signal:week_num' = "Vaccination Signal x Week",
    'vacc_assor' = "Vaccination Discordance",
    'vacc_signal:vacc_assor' = "Vaccination Signal x Discordance")

modelsummary(list(vacc_h1, vacc_h2, vacc_h3),
             title = "Linear Mixed Effects Regression Results for Vaccination Rates",
             notes= c('* p < .05. ** p < .01. *** p < .001 (two-tailed test).',
                      'Model 1 includes a random intercept for FIPS,',
                      'Models 2-3 include a random effect for Movement Signal by FIPS',
                      glue('N = {scales::label_comma()(nobs(vacc_h1))}, N of random Effects = {vacc_h3$dims$ngrps[["FIPS"]]}')),
             estimate = "{estimate}{stars}",
             coef_map = vacc_labels,
             gof_omit = 'AIC|BIC|ICC|RMSE')%>%
  kable_styling(latex_options = c("hold_position", 'condensed'),
                font_size = 8)

```

In Table \@ref(tab:vacc-tab) and Figures \@ref(fig:plot-vacc-h2) -
\@ref(fig:plot-vacc-h3), I present the elaboratory county-level models that
predict vaccination uptake rates. The parameter phi in model 1 is .985, which is
a good indicator that adjacent time points for each county are related and this
is an appropriate modeling technique for the data [@finch_etal14]. Table
\@ref(tab:vacc-tab) Model 1 addresses hypothesis 1, that relatively higher local
rates of infection will lead to increased vaccination uptake. In this first
model, we see various controls impacting vaccination rates. For instance, when
controlling for everything else, higher income areas lead to higher vaccination
uptake. On the other hand, counties with higher unemployment, higher votes for
Donald J. Trump in the 2020 election, are associated with lower vaccination
rates. Interestingly, counties that search for Fox News are more likely to have
higher vaccination rates while those searching for information about the vaccine
on Google are likely to have lower rates of vaccination. The test of Hypothesis
1 also returns surprising results: every 1 standard deviation increase in county
Covid-19 case rates is expected to yield a
`r broom.mixed::tidy(vacc_h1) %>% filter(term == 'case_rate') %>% pull(estimate) %>% round(3)`
decrease in vaccination rates. This may be due to time ordering or reverse
causality, where individuals in counties who have higher rates of vaccination
are less likely to take tests to Covid-19 infections because of the higher
likelihood of asymptomaticity. However, it is important to note that the Case
Rate variable actually becomes distorted with the addition of Vaccination Signal
and Vaccination Discordance in models 2 and 3. Distortion occurs when the
direction of a focal relationship reverses sign once a third (distorter)
variable is controlled, in this case, those related to signal. Therefore, the
results of hypothesis 1 are quite inconclusive.
```{r plot-vacc-h2}
#| dependson=c('vacc_models'),
#| cache = TRUE,
#| fig.cap='Predicted Values of Vaccination Rate'


pred4 <- ggpredict(vacc_h2, c("week_num", "vacc_signal")) %>% as_tibble()

pred4 %>% 
  mutate(group = case_when(group == 1 ~ "High",
                           group == 0 ~ "Average",
                           group == -1 ~ "Low"),
         group = fct_relevel(group, c("Low", "Average", "High"))) %>% 
ggplot(aes(x = x, y = predicted, color = group, fill = group)) + 
  geom_ribbon(aes(ymin = conf.low,ymax = conf.high),alpha = 0.5,color = NA) + 
    geom_line() + 
  labs(title='Interaction of Week Number by Vaccination Signal',
       x = "Week Number", 
       y = "Percent Fully Vaccinated, scaled)",
       fill = "Vaccination Signal", 
       color = "Vaccination Signal") +
  scale_fill_manual(values=my_palette[c(2,5,8)]) +
  scale_color_manual(values=my_palette[c(2,5,8)]) +
  theme_diss()
```

Table \@ref(tab:vacc-tab) model 2 tests the hypothesis 2 that increase vaccine
uptake by alters will have a positive effect on vaccine uptake for the
ego-county. The results are incredibly clear: seeing alter counties receiving
vaccines is associated with higher vaccination rates. Specifically, a 1 standard
deviation increase in vaccine signal, the average rate of vaccination of a
county's alters, is associated with a 
`r broom.mixed::tidy(vacc_h2) %>% filter(term == 'vacc_signal') %>% pull(estimate) %>% round(3)` 
percent increase of vaccination rates for the ego county. The strength of this
result leads me to reject the null hypothesis for hypothesis 2 and find that
increased average time spent in residence (signal direction) from alters will
have a positive effect on time spent in residence for the ego-county. The
interaction of vaccine signal can be seen in Figure \@ref(fig:plot-vacc-h2).
While the interaction is not as extreme as the results for Hypothesis 2 for
Stay-at-Home rates, there is still a distinction between high and low
vaccination signals over time. The slope for Higher Vaccination Signal is less
pronounced than Low Vaccination Signal. This is likely an artifact where some
counties vaccinated broadly early on, so their vaccination rate stays rather
constant in later weeks. However, overall, the message is clear: ego-counties
who 'see' high levels of vaccinations among their alters have higher vaccination
rates; those who don't see that social norm forming are much less likely to
vaccinate.
```{r plot-vacc-h3}
#|  dependson=c('plot_options','vacc_models'),
#|  cache = TRUE,
#|  fig.cap='Predicted Values of Vaccination Rate'

pred5 <- ggpredict(vacc_h3, c("vacc_signal", "vacc_assor")) %>% as_tibble()

pred5 %>% 
  mutate(group = case_when(group == 1 ~ "Discordance",
                           group == 0 ~ "Average",
                           group == -1 ~ "Concordance"),
         group = fct_relevel(as.factor(group), c("Discordance", "Average", "Concordance"))) %>% 
ggplot(aes(x = x, y = predicted, color = group, fill = group)) + 
  geom_ribbon(aes(ymin = conf.low,ymax = conf.high),alpha = 0.5,color = NA) + 
  geom_line() + 
  labs(title='Interaction of Vaccination Signal by Vaccination Discordance',
       x = "Vaccination Signal",
       y = "Vaccination Rate (in Percent)",
       fill = "Vaccination\nDiscordance",
       color = "Vaccination\nDiscordance") +
  scale_fill_manual(values=my_palette[c(2,5,8)]) +
  scale_color_manual(values=my_palette[c(2,5,8)]) +
  coord_cartesian(ylim=c(0,3), xlim=c(0,3)) +
  theme_diss()

```

Table \@ref(tab:vacc-tab) Model 3 then models the moderation of signal direction
for vaccine uptake by diversity in signals (_Discordance_). This is a second
test of Hypothesis 3, that the effect of signal direction on vaccine uptake will
be moderated by diversity in signals. The coefficients in model 3 are largely
largely consistent with model 2 and there is very little change in the magnitude
or significance of the coefficients. Vaccination signal maintains to have a positive
effect on the alter's vaccination rates, while vaccination discordance has a negative effect on stay-at-home rates, where every one standard deviation increase in discordance lowers rates by
`r broom.mixed::tidy(vacc_h3) %>% filter(term == 'vacc_assor') %>% pull(estimate) %>% round(3)`
(_p_ <  0.001). The interaction between signal and signal discordance have a
coefficient of a similar magnitude, with every one standard deviation increase
in discordance _and_ signal resulting in
`r broom.mixed::tidy(google_h3) %>% filter(term == 'vacc_signal:vacc_assor') %>% pull(estimate) %>% round(3)` 
lower rates of vaccination. Figure \@ref(fig:plot-vacc-h3) illustrates this
relationship, where there is slight moderation of the effect on vaccine signal
on vaccination rates. If a county receives consistently high signals, they are
more likely to have more residents vaccinated. If a county receives high but
inconsistent signals, they are still decently likely to raise vaccination rates
but to a lesser extent. While not as strong of moderation the the findings for Stay-at-Home Rates with hypothesis 3, I also reject the null hypothesis and find a moderation of the relationship between signal direction and vaccine uptake by diversity in signals (discordance).


# Conclusion

this is so critical, rewrite to be less critical


purpose of paper  

main finding  

- I might have more discussion about how the findings regarding stay-at-home rates are similar to / differ from those regarding vaccination rates. Why might we see the differences in estimates that we see across the two outcomes? An explicit comparison of how the control variables differ across the two outcomes could also be interesting to see.


limitations  

regardless of limitations, this is a contribution to x y z
new concept of discordance, 
measurement of complex contagion, 
meso-level networks


There are a few clear limitations to this study. This is sensitive to
aggregation error and sampling error from who the mobility and social
connectedness data is coming from. The aggregation errors are potentially linked
to the assumption that the average mobility behavior of a county is a good
representation of the diversity in movement behaviors within that county.
However, aggregating the network data provides a unique network perspective that
hasn't, to my knowledge, been explored. Sociological research has long debated
about the agency of individuals and the social and institutional structure in
which individuals are immersed. In this study, I aggregate beyond the individual
case to explore overall patterns of movement which summarizes individual agency
of movement together.

Another limitation of this study is possible sampling error. This project draws
on two big-data sources [@facebook20; @google2020]. While Facebook and Google
do extract data from a large portion of the population, I must be mindful of the
sampling issues involved in both data sets. The Facebook data is potentially
biased by both a skew of who allows location permissions but also who has a
Facebook account and has added their friends. While I have not found any
research comparing the demographics of Facebook users to actual population
(JK CHECK OUT [@bailey_etal18; @jones_etal13]), it
is easy to theorize how it may over or underrepresent different subsets of the
population in different areas [@salganikBitBitSocial2017 Section 2.3.6]. The friendship
indicator should also be read critically, because some individuals add everyone
they know as a friend, others add only close personal friends, and another
subset of the population adds many people who they do not know offline
[@courtoisSocialNetworkProfiles2012]. To my knowledge, there has been little research testing
whether these friendships represent offline connections [@golder2007rhythms;
@dunbar2016online]. In my case, however, the question of an online connection
versus and offline connection is unimportant because the movement contagion
could spread through online communication, offline communication, or simply
shared news stories and informal knowledge networks [@kittsRethinkingSocialNetworks2020].

The Google data must also be read critically because it is based on the
geo-behavioral data collected through Google Maps from users who have turned on
the Location History setting, which is off by default. This means our sample is
skewed to people in the United States a) with a mobile phone, b) with a Google
account, and c) with knowledge of how to synchronize their location history.
These requirements likely mean that there mobility data is skewed to a younger,
more affluent audience. Google has not made it clear whether their demographic
biases in their location history data are weighted in some way to rebalance the
data set so that it is representative
[@wangForecastingElectionsNonrepresentative2015; @salganikBitBitSocial2017,
Section 2.3.6]. It is therefore possible that the sampling bias may confound my
results if the age distribution through a population is associated with mobility
during COVID-19. Furthermore, Google has defined time spent in residential areas
without much context or explanation for how they classify a residential area. In
counties with a lot of vertical mobility (i.e. skyscrapers) where a residential
area may overlap with a shopping mall, there is a much larger margin of error.



\newpage

# References {-}

<div id="refs"></div>


